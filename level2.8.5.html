<html>
<head>
	<meta charset="UTF-8">
	<title>Каменогорск. Уровень 2. Блок водоподготовки</title>
	<link rel="stylesheet" href="/leaflet.css" />
<link rel="stylesheet" href="/css/areal.css" />
	<script src="/leaflet.js" type="text/javascript"></script>
	<script src="./dist/PruneCluster.js" type="text/javascript"></script>
	<script src="./layer/Marker.Text.js" type="text/javascript"></script>
	<script src="./jquery-2.1.1.min.js" type="text/jscript"></script>
	
	<script src="./draw/src/leaflet.circle.topolygon-src.js"></script>
	<script src="./draw/src/Leaflet.draw.js"></script>
    <script src="./draw/src/Leaflet.Draw.Event.js"></script>
    <link rel="stylesheet" href="./draw/src/leaflet.draw.css"/>

    <script src="./draw/src/Toolbar.js"></script>
    <script src="./draw/src/Tooltip.js"></script>

    <script src="./draw/src/ext/GeometryUtil.js"></script>
    <script src="./draw/src/ext/LatLngUtil.js"></script>
    <script src="./draw/src/ext/LineUtil.Intersect.js"></script>
    <script src="./draw/src/ext/Polygon.Intersect.js"></script>
    <script src="./draw/src/ext/Polyline.Intersect.js"></script>
    <script src="./draw/src/ext/TouchEvents.js"></script>

    <script src="./draw/src/draw/DrawToolbar.js"></script>
    <script src="./draw/src/draw/handler/Draw.Feature.js"></script>
    <script src="./draw/src/draw/handler/Draw.SimpleShape.js"></script>
    <script src="./draw/src/draw/handler/Draw.Polyline.js"></script>
    <script src="./draw/src/draw/handler/Draw.Circle.js"></script>
    <script src="./draw/src/draw/handler/Draw.Marker.js"></script>
    <script src="./draw/src/draw/handler/Draw.Polygon.js"></script>
    <script src="./draw/src/draw/handler/Draw.Rectangle.js"></script>


    <script src="./draw/src/edit/EditToolbar.js"></script>
    <script src="./draw/src/edit/handler/EditToolbar.Edit.js"></script>
    <script src="./draw/src/edit/handler/EditToolbar.Delete.js"></script>

    <script src="./draw/src/Control.Draw.js"></script>

    <script src="./draw/src/edit/handler/Edit.Poly.js"></script>
    <script src="./draw/src/edit/handler/Edit.SimpleShape.js"></script>
    <script src="./draw/src/edit/handler/Edit.Circle.js"></script>
    <script src="./draw/src/edit/handler/Edit.Rectangle.js"></script>
    <script src="./draw/src/edit/handler/Edit.Marker.js"></script>
	
	
	<script src="./dist/easy-button.js" type="text/javascript"></script>
	<link rel="stylesheet" href="./dist/easy-button.css"/>
	<script src="./dist/jQuery.print.js" type="text/javascript"></script>
	
	
</head>
<body oncontextmenu="return false">
	<div style="position:absolute; top:0px; left:0px; height:30px; width:1000px; background: #bfbfbf; padding:10px; overflow-y: scroll;" id="brief"><table border="0"><tr>	<td width="90px" ><span id="vP1">?</span></td>	<td width="90px" ><span id="vP2">?</span></td>	<td width="90px" ><span id="vP3">?</span></td>	<td width="90px" ><span id="vP4">?</span></td>	<td width="90px" ><span id="vP5">?</span></td>	<td width="90px" ><span id="vP6">?</span></td>	<td width="90px" ><span id="vP7">?</span></td>	<td width="90px" ><span id="vP8">?</span></td>	<td width="90px" ><span id="vP9">?</span></td>	<td width="90px" ><span id="vP0">?</span></td>	</tr></table>	</div>	<div style="position:absolute; width:1000px; bottom:0px; top:50px;" id="map"></div>
	<div style="position:absolute; width:990px; bottom:0px; top:0px; left:0px; background: #aeaeae; padding:10px; display:none; z-index:1200; "  id="detail">
		<h1><a href="#" onclick=' $("#detail").hide(); return false;' ><img src="images/close.png" alt="Закрыть" border="0" width="30px" height="30px" /></a> Детальная информация</h1>
		<hr>
		<div id="detail_info">
		</div>
	</div>
	<div style="position:absolute; top:0px; left:1008px; right:0px; bottom:0px; background: #bfbfbf; padding:10px; overflow-y: scroll;" id="brief">
<h1>
	<a href="level1.html"><img src="images\home.png" alt="Главный экран" width="50px"; height="50px"; /></a>
	<img src="/images/areal.logo.png" border="0"; width="250px"; height="50px";  align="right" />
	</h1>
	<a href="level2.8.html"><h2>Блок водоподготовки</h2></a>
	<h2>Подсистема 5 (ШУ2,ШУ3)</h2>
	<!--
	<h3> Датчики </h3>
	<ul>
	<li><a href="#" onclick='GetDitail("85.41");'>FE6a : <span id="v85.41">?</span></a></li>
	
	</ul>
	-->
	
	<h3> Задвижка </h3>
	<ul>
	<li><a href="#" onclick='GetDitail("85.23");'>Задвижка 3.4M1 : <span id="v85.23">?</span></a></li>
	<li><a href="#" onclick='GetDitail("85.21");'>Задвижка 3.4M2 : <span id="v85.21">?</span></a></li>
	<li><a href="#" onclick='GetDitail("85.22");'>Задвижка 3.4M3 : <span id="v85.22">?</span></a></li>
	<li><a href="#" onclick='GetDitail("85.24");'>Задвижка 3.4M4 : <span id="v85.24">?</span></a></li>
	<li><a href="#" onclick='GetDitail("85.25");'>Задвижка 3.4M5 : <span id="v85.25">?</span></a></li>

	<li><a href="#" onclick='GetDitail("85.28");'>Задвижка 3.5M1 : <span id="v85.28">?</span></a></li>
	<li><a href="#" onclick='GetDitail("85.26");'>Задвижка 3.5M2 : <span id="v85.26">?</span></a></li>
	<li><a href="#" onclick='GetDitail("85.27");'>Задвижка 3.5M3 : <span id="v85.27">?</span></a></li>
	<li><a href="#" onclick='GetDitail("85.29");'>Задвижка 3.5M4  : <span id="v85.29">?</span></a></li>
	<li><a href="#" onclick='GetDitail("85.30");'>Задвижка 3.5M5  : <span id="v85.30">?</span></a></li>
	
	<li><a href="#" onclick='GetDitail("85.33");'>Задвижка 3.6M1  : <span id="v85.33">?</span></a></li>
	<li><a href="#" onclick='GetDitail("85.31");'>Задвижка 3.6M2  : <span id="v85.31">?</span></a></li>
	<li><a href="#" onclick='GetDitail("85.32");'>Задвижка 3.6M3  : <span id="v85.32">?</span></a></li>
	<li><a href="#" onclick='GetDitail("85.34");'>Задвижка 3.6M4  : <span id="v85.34">?</span></a></li>
	<li><a href="#" onclick='GetDitail("85.35");'>Задвижка 3.6M5  : <span id="v85.35">?</span></a></li>
	</ul>
	<hr>
	<span id="v210"></span><br/>
	<span id="v211"></span><br/>
	<span id="v212"></span><br/>
	<span id="v213"></span><br/>
	</div>
<script type='text/javascript'>
function GetDitail(sid){
 return; 

	$("#detail").show(); 
	var item=document.getElementById('detail_info');
	if( item!=null){
		item.innerHTML =sid;
	}else{
		console.log(v.ID);
	}
	return false;
}
	var imgW=1403;
	var imgH=635;

	var imageUrl = './images/l2_8.5.png', imageBounds = [[-imgH/20, -imgW/20], [imgH/20, imgW/20]];
	
	var map = L.map('map', { minZoom: 2, maxZoom: 7,attributionControl:false});  //.setView([27, 44], 3);
    map.attributionControl = false;
    L.imageOverlay(imageUrl, imageBounds, { opacity: 1 }).addTo(map); // , attribution: 'Цех:<%=GetC()%>'
	map.setView([0, 0], 4);
	map.fitBounds(imageBounds);
	map.setMaxBounds([[-imgH/15, -imgW/15], [imgH/15, imgW/15]])
		L.easyButton({
	  id: 'id-map-print',  // an id for the generated button
	  position: 'topleft',      // inherited from L.Control -- the corner it goes in
	  type: 'replace',          // set to animate when you're comfy with css
	  leafletClasses: true,     // use leaflet classes to style the button?
	  states:[{                 // specify different icons and responses for your button
		stateName: 'map-print',
		onClick: function(button, map){
			$('#map').print();
		},
		title: 'Печать',
		icon: '<img src="/images/print.png" width="18px;" height="18px">'
	  }]
	}).addTo( map );
	
	/* var  drawnItems = L.featureGroup().addTo(map);
	
	
    map.addControl(new L.Control.Draw({
        edit: {
            featureGroup: drawnItems,
            poly: {
                allowIntersection: false
            }
        },
        draw: {
            polygon: {
                allowIntersection: false,
                showArea: true
            }
        }
    }));
	*/
	
	

	var rgb = '#00FF00'; // green
	var bounds;
    map.on(L.Draw.Event.CREATED, function (event) {
        var layer = event.layer;
        var s ="";
		if(typeof layer.toPolygon =='undefined'){
			s= JSON.stringify(layer.toGeoJSON()) ;
			drawnItems.addLayer(layer);
		}else{
			
			//alert ( JSON.stringify(layer.toPolygon(24,map)) );
			bounds=layer.toPolygon(24,map);
			var player= L.polygon( bounds, {  color: rgb, opacity: 1.0, fillOpacity: 1, weight: 1 } );
			s= JSON.stringify(player.toGeoJSON());
			drawnItems.addLayer(player);
		}
		
		$.ajax({
		  type: 'GET',
		  url: 'savelayer.aspx',
		  data: 'P=l2_85&L=' +s,
		  success: function(data){
			//$('.results').html(data);
		  }
		});
		
    });
	
	
	
	
	
	
	map.on('contextmenu',function(event){ }); 
 var stanki =[];
	var blink=true;
	  
	    function MapX(X) {
            var mx = parseInt(X);
            mx = mx / 10 -imgW/20;
            return mx;
        }

        function MapY(Y) {
            var my = parseInt(Y);
            my =  imgH/20 - my / 10;
            return my;
        }
	
	var rect;
	var bounds;
	var rgb = '#dddddd';
	var marker;
		function RCW(deviceID, QReg, Reg1, Bit1, Val1, Reg2, Bit2, Val2) {
	    $.ajax({
	        dataType: "json",
	        type: 'POST',
	        url: 'rcw.aspx',
	        data: 'id=' + deviceID + '&qreg=' + QReg + '&reg1=' + Reg1 + '&bit1=' + Bit1 + '&val1=' + Val1 + '&reg2=' + Reg2 + '&bit2=' + Bit2 + '&val2=' + Val2,
	        success: function (data) {
	            map.closePopup();
	        }
	    });
	}
	
    bounds=FlipLL([[-50.66532237447379,18.07323752975647,0],[-50.86669889406782,17.989824644197135,0],[-51.039624831762175,17.857133905282684,0],[-51.17231557067662,17.684207967588325,0],[-51.25572845623596,17.482831447994304,0],[-51.28417903813562,17.26672782352052,0],[-51.25572845623596,17.050624199046734,0],[-51.17231557067662,16.849247679452713,0],[-51.039624831762175,16.676321741758354,0],[-50.86669889406782,16.543631002843902,0],[-50.66532237447379,16.46021811728457,0],[-50.44921875000001,16.431767535384907,0],[-50.23311512552622,16.46021811728457,0],[-50.0317386059322,16.543631002843902,0],[-49.85881266823784,16.676321741758354,0],[-49.72612192932339,16.849247679452713,0],[-49.64270904376406,17.050624199046734,0],[-49.614258461864395,17.26672782352052,0],[-49.64270904376406,17.482831447994304,0],[-49.72612192932339,17.684207967588325,0],[-49.85881266823784,17.857133905282684,0],[-50.0317386059322,17.989824644197135,0],[-50.23311512552622,18.07323752975647,0],[-50.66532237447379,18.07323752975647,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '85.21';
	rect.bindPopup(
	'<h3>Задвижка 3.4М2</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW( 393 , 2, 352 , 4 , 0 , 352 , 3 , 1 );"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW( 393 , 2, 352 , 3 , 0 , 352 , 4 , 1 );"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW( 393 , 2, 352 , 3 , 0 , 352 , 4 , 0 );"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.4М2');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	 
	
	bounds=FlipLL([[-46.79845511051251,15.540090924821333,0],[-47.00013004258844,15.456554432764813,0],[-47.173312232890375,15.323667064308825,0],[-47.306199601346364,15.150484874006882,0],[-47.38973609340289,14.948809941930962,0],[-47.41822883517686,14.732386081418454,0],[-47.38973609340289,14.515962220905946,0],[-47.306199601346364,14.314287288830027,0],[-47.173312232890375,14.141105098528083,0],[-47.00013004258844,14.008217730072095,0],[-46.79845511051251,13.924681238015575,0],[-46.58203125000001,13.896188496241598,0],[-46.3656073894875,13.924681238015577,0],[-46.163932457411576,14.008217730072095,0],[-45.99075026710963,14.141105098528083,0],[-45.85786289865365,14.314287288830027,0],[-45.774326406597126,14.515962220905946,0],[-45.74583366482315,14.732386081418454,0],[-45.774326406597126,14.948809941930962,0],[-45.85786289865365,15.150484874006882,0],[-45.99075026710963,15.323667064308824,0],[-46.163932457411576,15.456554432764813,0],[-46.3656073894875,15.540090924821332,0],[-46.79845511051251,15.540090924821333,0]]) ;
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '85.22';
	rect.bindPopup(
	'<h3>Задвижка 3.4М3</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW( 393 , 2, 352 , 7 , 0 , 352 , 6 , 1 );"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW( 393 , 2, 352 , 6 , 0 , 352 , 7 , 1 );"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW( 393 , 2, 352 , 6 , 0 , 352 , 7 , 0 );"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.4М3');
	rect.on('contextmenu',function(event){ }); 
    rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	bounds=FlipLL([[-38.58267216563125,4.679388078709499,0],[-38.78620194154338,4.595083285179936,0],[-38.960976922356856,4.460973725578255,0],[-39.09508648195853,4.286198744764786,0],[-39.1793912754881,4.082668968852651,0],[-39.208146070586764,3.864254615721409,0],[-39.1793912754881,3.6458402625901654,0],[-39.09508648195853,3.4423104866780316,0],[-38.960976922356856,3.2675355058645614,0],[-38.78620194154338,3.133425946262881,0],[-38.58267216563125,3.049121152733318,0],[-38.36425781250001,3.0203663576346544,0],[-38.14584345936876,3.0491211527333184,0],[-37.94231368345663,3.1334259462628813,0],[-37.76753870264316,3.267535505864562,0],[-37.63342914304148,3.4423104866780316,0],[-37.549124349511914,3.6458402625901654,0],[-37.52036955441325,3.8642546157214084,0],[-37.549124349511914,4.082668968852651,0],[-37.63342914304148,4.286198744764785,0],[-37.76753870264316,4.4609737255782544,0],[-37.94231368345663,4.5950832851799355,0],[-38.14584345936876,4.679388078709498,0],[-38.58267216563125,4.679388078709499,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '85.23';
	rect.bindPopup(
	'<h3>Задвижка 3.4М1</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW( 393 , 2, 352 , 1 , 0 , 352 , 0 , 1 );"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW( 393 , 2, 352 , 0 , 0 , 352 , 1 , 1 );"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW( 393 , 2, 352 , 0 , 0 , 352 , 1 , 0 );"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.4М1');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	 
	
	bounds=FlipLL([[-28.29238238338631,16.157635594628864,0],[-28.489308446033494,16.076066148695666,0],[-28.658412689707855,15.946307898742559,0],[-28.788170939660965,15.777203655068195,0],[-28.869740385594163,15.580277592421012,0],[-28.897562204566984,15.368949896534705,0],[-28.869740385594163,15.1576222006484,0],[-28.788170939660965,14.960696138001214,0],[-28.65841268970786,14.791591894326851,0],[-28.489308446033494,14.661833644373742,0],[-28.29238238338631,14.580264198440545,0],[-28.081054687500004,14.552442379467722,0],[-27.869726991613696,14.580264198440545,0],[-27.672800928966513,14.661833644373743,0],[-27.503696685292148,14.791591894326851,0],[-27.373938435339042,14.960696138001214,0],[-27.292368989405844,15.1576222006484,0],[-27.264547170433023,15.368949896534705,0],[-27.292368989405844,15.58027759242101,0],[-27.373938435339042,15.777203655068195,0],[-27.503696685292148,15.946307898742559,0],[-27.672800928966513,16.076066148695666,0],[-27.869726991613696,16.157635594628864,0],[-28.29238238338631,16.157635594628864,0]]) ;
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '85.24';
	rect.bindPopup(
	'<h3>Задвижка 3.4М4</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW( 393 , 2, 352 , 10 , 0 , 352 , 9 , 1 );"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW( 393 , 2, 352 , 9 , 0 , 352 , 10 , 1 );"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW( 393 , 2, 352 , 9 , 0 , 352 , 10 , 0 );"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.4М4');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	
	bounds=FlipLL([[-26.626015167017165,13.313617265679106,0],[-26.826253644183865,13.230675772727725,0],[-26.99820232269092,13.098734911161944,0],[-27.130143184256696,12.92678623265489,0],[-27.21308467720808,12.726547755488193,0],[-27.241374475867723,12.511665400971031,0],[-27.21308467720808,12.29678304645387,0],[-27.130143184256696,12.096544569287172,0],[-26.99820232269092,11.924595890780118,0],[-26.826253644183865,11.792655029214338,0],[-26.626015167017165,11.709713536262957,0],[-26.411132812500004,11.681423737603312,0],[-26.196250457982842,11.709713536262957,0],[-25.996011980816142,11.792655029214338,0],[-25.82406330230909,11.924595890780118,0],[-25.69212244074331,12.096544569287172,0],[-25.609180947791927,12.29678304645387,0],[-25.580891149132285,12.511665400971031,0],[-25.609180947791927,12.726547755488193,0],[-25.69212244074331,12.92678623265489,0],[-25.82406330230909,13.098734911161944,0],[-25.996011980816142,13.230675772727723,0],[-26.196250457982842,13.313617265679106,0],[-26.626015167017165,13.313617265679106,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '85.25';
	rect.bindPopup(
	'<h3>Задвижка 3.4М5</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW( 393 , 2, 352 , 13 , 0 , 352 , 12 , 1 );"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW( 393 , 2, 352 , 12 , 0 , 352 , 13 , 1 );"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW( 393 , 2, 352 , 12 , 0 , 352 , 13 , 0 );"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.4М5');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	 
	
	bounds=FlipLL([[-9.433206553599751,18.072604832152752,0],[-9.62394813368318,17.99359708277372,0],[-9.78774164178297,17.867913903553003,0],[-9.913424821003689,17.704120395453213,0],[-9.99243257038272,17.513378815369784,0],[-10.01938064236636,17.308687886770034,0],[-9.99243257038272,17.103996958170285,0],[-9.913424821003689,16.913255378086856,0],[-9.78774164178297,16.749461869987066,0],[-9.62394813368318,16.623778690766347,0],[-9.433206553599751,16.544770941387316,0],[-9.228515625000002,16.517822869403677,0],[-9.023824696400252,16.544770941387316,0],[-8.833083116316823,16.623778690766347,0],[-8.669289608217033,16.749461869987066,0],[-8.543606428996315,16.913255378086856,0],[-8.464598679617284,17.103996958170285,0],[-8.437650607633644,17.308687886770034,0],[-8.464598679617284,17.513378815369784,0],[-8.543606428996315,17.704120395453213,0],[-8.669289608217033,17.867913903553003,0],[-8.833083116316821,17.99359708277372,0],[-9.02382469640025,18.072604832152752,0],[-9.433206553599751,18.072604832152752,0]]) ;
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '85.26';
	rect.bindPopup(
	'<h3>Задвижка 3.5М2</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW( 394 , 2, 351 , 4 , 0 , 351 , 3 , 1 );"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW( 394 , 2, 351 , 3 , 0 , 351 , 4 , 1 );"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW( 394 , 2, 351 , 3 , 0 , 351 , 4 , 0 );"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.5М2');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	
	bounds=FlipLL([[-5.762539874927791,15.57370416072462,0],[-5.972607658827018,15.4866912356159,0],[-6.152996954378376,15.34827366079683,0],[-6.291414529197446,15.167884365245472,0],[-6.378427454306166,14.957816581346245,0],[-6.408105942654036,14.732386081418454,0],[-6.378427454306166,14.506955581490665,0],[-6.291414529197446,14.296887797591436,0],[-6.152996954378376,14.116498502040079,0],[-5.972607658827018,13.978080927221008,0],[-5.762539874927791,13.891068002112288,0],[-5.537109375000001,13.86138951376442,0],[-5.31167887507221,13.891068002112288,0],[-5.101611091172983,13.97808092722101,0],[-4.921221795621625,14.116498502040079,0],[-4.782804220802555,14.296887797591438,0],[-4.6957912956938355,14.506955581490663,0],[-4.666112807345966,14.732386081418454,0],[-4.6957912956938355,14.957816581346243,0],[-4.782804220802555,15.16788436524547,0],[-4.921221795621625,15.34827366079683,0],[-5.101611091172982,15.486691235615899,0],[-5.311678875072209,15.573704160724619,0],[-5.762539874927791,15.57370416072462,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '85.27';
	rect.bindPopup(
	'<h3>Задвижка 3.5М3</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW( 394 , 2, 351 , 7 , 0 , 351 , 6 , 1 );"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW( 394 , 2, 351 , 6 , 0 , 351 , 7 , 1 );"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW( 394 , 2, 351 , 6 , 0 , 351 , 7 , 0 );"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.5М3');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	 
	
	bounds=FlipLL([[2.5635939510058763,4.673022764046931,0],[2.3726009499901948,4.593910872707897,0],[2.208591541841317,4.468062027552807,0],[2.0827426966862266,4.304052619403929,0],[2.0036308053471927,4.113059618388247,0],[1.976647212480389,3.9080988818941234,0],[2.0036308053471927,3.703138145399999,0],[2.082742696686226,3.5121451443843172,0],[2.208591541841317,3.3481357362354394,0],[2.3726009499901948,3.2222868910803486,0],[2.5635939510058763,3.143174999741315,0],[2.768554687500001,3.1161914068745116,0],[2.973525423994125,3.143174999741315,0],[3.1645084250098066,3.222286891080349,0],[3.3285178331586844,3.34813573623544,0],[3.4543666783137748,3.5121451443843177,0],[3.533478569652808,3.7031381453999987,0],[3.560462162519612,3.908098881894123,0],[3.533478569652808,4.113059618388247,0],[3.454366678313775,4.304052619403928,0],[3.328517833158685,4.468062027552806,0],[3.164508425009807,4.593910872707896,0],[2.973525423994126,4.67302276404693,0],[2.5635939510058763,4.673022764046931,0]]) ;
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '85.28';
	rect.bindPopup(
	'<h3>Задвижка 3.5М1</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW( 394 , 2, 351 , 1 , 0 , 351 , 0 , 1 );"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW( 394 , 2, 351 , 0 , 0 , 351 , 1 , 1 );"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW( 394 , 2, 351 , 0 , 0 , 351 , 1 , 0 );"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.5М1');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	
	bounds=FlipLL([[12.831350100897943,16.191522674613573,0],[12.625962810600601,16.106448473433353,0],[12.44959274602319,15.971114963011516,0],[12.314259235601352,15.794744898434107,0],[12.229185034421132,15.589357608136764,0],[12.200167808701199,15.368949896534705,0],[12.229185034421132,15.148542184932648,0],[12.314259235601352,14.943154894635304,0],[12.44959274602319,14.766784830057894,0],[12.625962810600601,14.631451319636055,0],[12.831350100897943,14.546377118455835,0],[13.051757812500002,14.517359892735902,0],[13.27216552410206,14.546377118455835,0],[13.477552814399404,14.631451319636055,0],[13.653922878976813,14.766784830057894,0],[13.789256389398652,14.943154894635304,0],[13.874330590578872,15.148542184932646,0],[13.903347816298805,15.368949896534705,0],[13.874330590578872,15.589357608136762,0],[13.789256389398652,15.794744898434105,0],[13.653922878976815,15.971114963011516,0],[13.477552814399404,16.106448473433353,0],[13.27216552410206,16.191522674613573,0],[12.831350100897943,16.191522674613573,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '85.29';
	rect.bindPopup(
	'<h3>Задвижка 3.5М4</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW( 394 , 2, 351 , 10 , 0 , 351 , 9 , 1 );"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW( 394 , 2, 351 , 9 , 0 , 351 , 10 , 1 );"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW( 394 , 2, 351 , 9 , 0 , 351 , 10 , 0 );"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.5М4');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
		
	bounds=FlipLL([[14.57017309155088,13.283999981362095,0],[14.388040907663013,13.20855836065111,0],[14.231640455680699,13.088548072912973,0],[14.111630167942561,12.932147620930659,0],[14.036188547231577,12.750015437042792,0],[14.010456815326027,12.55456352859367,0],[14.036188547231575,12.359111620144548,0],[14.111630167942561,12.176979436256682,0],[14.231640455680699,12.020578984274367,0],[14.388040907663013,11.90056869653623,0],[14.57017309155088,11.825127075825245,0],[14.765625000000002,11.799395343919695,0],[14.961076908449124,11.825127075825245,0],[15.14320909233699,11.90056869653623,0],[15.299609544319306,12.020578984274367,0],[15.419619832057444,12.176979436256682,0],[15.495061452768427,12.359111620144548,0],[15.520793184673977,12.55456352859367,0],[15.495061452768429,12.750015437042792,0],[15.419619832057444,12.932147620930657,0],[15.299609544319306,13.088548072912973,0],[15.14320909233699,13.20855836065111,0],[14.961076908449126,13.283999981362095,0],[14.57017309155088,13.283999981362095,0]]) ;
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '85.30';
	rect.bindPopup(
	'<h3>Задвижка 3.5М5</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW( 394 , 2, 351 , 13 , 0 , 351 , 12 , 1 );"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW( 394 , 2, 351 , 12 , 0 , 351 , 13 , 1 );"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW( 394 , 2, 351 , 12 , 0 , 351 , 13 , 0 );"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.5М5');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	
	bounds=FlipLL([[31.690091090989757,18.108114755971393,0],[31.490483077168015,18.02543440948807,0],[31.31907578980889,17.89390897196115,0],[31.187550352281967,17.722501684602022,0],[31.104870005798645,17.52289367078028,0],[31.07666927933603,17.308687886770034,0],[31.104870005798645,17.09448210275979,0],[31.187550352281967,16.894874088938046,0],[31.31907578980889,16.72346680157892,0],[31.490483077168015,16.591941364051998,0],[31.69009109098976,16.509261017568676,0],[31.904296875000004,16.48106029110606,0],[32.11850265901025,16.509261017568676,0],[32.31811067283199,16.591941364051998,0],[32.489517960191115,16.72346680157892,0],[32.62104339771804,16.894874088938046,0],[32.70372374420136,17.09448210275979,0],[32.73192447066398,17.308687886770034,0],[32.70372374420136,17.522893670780277,0],[32.62104339771804,17.722501684602022,0],[32.489517960191115,17.89390897196115,0],[32.31811067283199,18.02543440948807,0],[32.11850265901025,18.108114755971393,0],[31.690091090989757,18.108114755971393,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '85.31';
	rect.bindPopup(
	'<h3>Задвижка 3.6М2</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW( 394 , 2, 352 , 4 , 0 , 352 , 3 , 1 );"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW( 394 , 2, 352 , 3 , 0 , 352 , 4 , 1 );"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW( 394 , 2, 352 , 3 , 0 , 352 , 4 , 0 );"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.6М2');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	 
	
	bounds=FlipLL([[35.42263015556486,15.584805760869555,0],[35.220401310903924,15.501039830707953,0],[35.046743465081875,15.367787478934407,0],[34.913491113308325,15.194129633112357,0],[34.82972518314673,14.99190078845142,0],[34.80115418430784,14.774882506516272,0],[34.82972518314673,14.557864224581124,0],[34.913491113308325,14.355635379920187,0],[35.046743465081875,14.18197753409814,0],[35.220401310903924,14.048725182324592,0],[35.42263015556486,13.96495925216299,0],[35.63964843750001,13.936388253324102,0],[35.856666719435254,13.96495925216299,0],[36.05889556409609,14.048725182324592,0],[36.23255340991814,14.18197753409814,0],[36.36580576169169,14.355635379920187,0],[36.449571691853286,14.557864224581124,0],[36.478142690692174,14.774882506516272,0],[36.449571691853286,14.99190078845142,0],[36.36580576169169,15.194129633112357,0],[36.23255340991814,15.367787478934405,0],[36.05889556409609,15.501039830707953,0],[35.856666719435254,15.584805760869553,0],[35.42263015556486,15.584805760869555,0]]) ;
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '85.32';
	rect.bindPopup(
	'<h3>Задвижка 3.6М3</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW( 394 , 2, 352 , 7 , 0 , 352 , 6 , 1 );"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW( 394 , 2, 352 , 6 , 0 , 352 , 7 , 1 );"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW( 394 , 2, 352 , 6 , 0 , 352 , 7 , 0 );"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.6М3');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	bounds=FlipLL([[43.780249241336755,4.644285222520043,0],[43.585484258895285,4.563610925317428,0],[43.41823577686463,4.435276651356791,0],[43.28990150290399,4.268028169326134,0],[43.209227205701374,4.073263186884661,0],[43.181710705290556,3.864254615721409,0],[43.209227205701374,3.655246044558156,0],[43.28990150290399,3.4604810621166835,0],[43.41823577686463,3.293232580086026,0],[43.585484258895285,3.1648983061253886,0],[43.780249241336755,3.084224008922773,0],[43.98925781250001,3.056707508511958,0],[44.19826638366326,3.0842240089227735,0],[44.39303136610473,3.164898306125389,0],[44.56027984813539,3.2932325800860265,0],[44.68861412209603,3.4604810621166835,0],[44.76928841929864,3.6552460445581554,0],[44.79680491970946,3.8642546157214084,0],[44.76928841929864,4.073263186884661,0],[44.68861412209603,4.268028169326133,0],[44.56027984813539,4.43527665135679,0],[44.393031366104736,4.563610925317428,0],[44.19826638366326,4.644285222520043,0],[43.780249241336755,4.644285222520043,0]]) ;
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '85.33';
	rect.bindPopup(
	'<h3>Задвижка 3.6М1</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW( 394 , 2, 352 , 1 , 0 , 352 , 0 , 1 );"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW( 394 , 2, 352 , 0 , 0 , 352 , 1 , 1 );"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW( 394 , 2, 352 , 0 , 0 , 352 , 1 , 0 );"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.6М1');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	bounds=FlipLL([[54.11545120361145,16.161293821140468,0],[53.928190911540355,16.083728068470673,0],[53.767386853229105,15.960338774751909,0],[53.64399755951034,15.79953471644066,0],[53.56643180684054,15.612274424369565,0],[53.539975573080696,15.411319377981005,0],[53.56643180684054,15.210364331592446,0],[53.64399755951034,15.023104039521352,0],[53.767386853229105,14.862299981210102,0],[53.928190911540355,14.738910687491337,0],[54.11545120361145,14.661344934821543,0],[54.31640625000001,14.634888701061698,0],[54.517361296388565,14.661344934821543,0],[54.70462158845966,14.738910687491337,0],[54.86542564677091,14.862299981210102,0],[54.988814940489675,15.023104039521352,0],[55.06638069315947,15.210364331592446,0],[55.09283692691932,15.411319377981005,0],[55.06638069315947,15.612274424369565,0],[54.988814940489675,15.79953471644066,0],[54.86542564677091,15.960338774751909,0],[54.70462158845966,16.083728068470673,0],[54.517361296388565,16.161293821140468,0],[54.11545120361145,16.161293821140468,0]]) ;
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '85.34';
	rect.bindPopup(
	'<h3>Задвижка 3.6М4</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW( 394 , 2, 352 , 10 , 0 , 352 , 9 , 1 );"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW( 394 , 2, 352 , 9 , 0 , 352 , 10 , 1 );"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW( 394 , 2, 352 , 9 , 0 , 352 , 10 , 0 );"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.6М4');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	bounds=FlipLL([[55.81457751100326,13.316653557642514,0],[55.613580905442895,13.233398037628458,0],[55.44098120732526,13.100957631145771,0],[55.30854080084257,12.928357933028135,0],[55.225285280828516,12.727361327467774,0],[55.1968883733858,12.511665400971031,0],[55.225285280828516,12.29596947447429,0],[55.30854080084257,12.094972868913928,0],[55.44098120732526,11.922373170796291,0],[55.613580905442895,11.789932764313605,0],[55.81457751100326,11.706677244299549,0],[56.0302734375,11.678280336856826,0],[56.24596936399674,11.706677244299549,0],[56.446965969557105,11.789932764313606,0],[56.61956566767474,11.922373170796291,0],[56.75200607415743,12.094972868913928,0],[56.835261594171484,12.29596947447429,0],[56.8636585016142,12.511665400971031,0],[56.835261594171484,12.727361327467772,0],[56.75200607415743,12.928357933028133,0],[56.61956566767474,13.100957631145771,0],[56.446965969557105,13.233398037628456,0],[56.24596936399674,13.316653557642514,0],[55.81457751100326,13.316653557642514,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '85.35';
	rect.bindPopup(
	'<h3>Задвижка 3.6М5</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW( 394 , 2, 352 , 13 , 0 , 352 , 12 , 1 );"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW( 394 , 2, 352 , 12 , 0 , 352 , 13 , 1 );"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW( 394 , 2, 352 , 12 , 0 , 352 , 13 , 0 );"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.6М5');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	/*
	bounds=FlipLL([[-51.087192212533076,13.256191414061,0],[-51.476936277514575,13.094754136491241,0],[-51.81161709349853,12.83794451402793,0],[-52.06842671596185,12.50326369804397,0],[-52.2298639935316,12.113529633062472,0],[-52.28492724252914,11.695272733029402,0],[-52.2298639935316,11.277025832996333,0],[-52.06842671596185,10.887281768014834,0],[-51.81161709349853,10.552600952030874,0],[-51.476936277514575,10.295791329567562,0],[-51.087192212533076,10.134354051997803,0],[-50.66894531250001,10.079290803000264,0],[-50.25069841246694,10.134354051997803,0],[-49.86095434748544,10.295791329567562,0],[-49.52627353150148,10.552600952030875,0],[-49.269463909038166,10.887281768014834,0],[-49.10802663146841,11.277025832996332,0],[-49.05296338247087,11.695272733029402,0],[-49.10802663146841,12.11352963306247,0],[-49.269463909038166,12.50326369804397,0],[-49.52627353150148,12.837944514027928,0],[-49.86095434748544,13.09475413649124,0],[-50.25069841246693,13.256191414060998,0],[-51.087192212533076,13.256191414061,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '85.41';
	//rect.bindPopup('Датчик 1');
	rect.bindTooltip('Датчик 1');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	*/
	
	function FlipLL(b) {
		var fb;
		var point;
		var j;
		fb=[];
		for (j = 0; j < b.length; j++) {
			 point =new  L.latLng(
			  b[j][1],               
			  b[j][0],               
               b[j][2]             
            );
			fb.push(point)
		}
		return fb;
	}


    function ReloadData() {

             function OnRequestReady(data) {

                $.each(data.data, function (i, v) {
                    var ok = false;
                    var rect;
                    var j;
                    for (j = 0; j < stanki.length; j++) {
                        if (stanki[j].tag == v.ID) {
                            ok = true;
                            rect = stanki[j];
                            break;
                        }
                    }

                    if (ok) {
						if(v.BLINK=='YES'){
							blink=true;
						}else{
							blink=false;
						}
					
						switch (v.COLOR) {
							case 'GREEN':
								 rgb = '#00FF00'; // green
								break;
							case 'YELLOW':
								rgb = '#dddd00';
								break;
							case 'RED':
								 rgb = '#FF0000'; //red
								break;
							default:
								rgb = '#000000'; //black
								break;
						}
                        rect.setStyle({ color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 1 });
                       // //rect.bindPopup(sPopup);
                       // rect.marker.bindPopup(sPopup);
                        rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
					}
					if(v.INFO !=null){
						var item=document.getElementById('v' +v.ID);
						if( item!=null){
							item.innerHTML =v.INFO;
						}else{
							console.log(v.ID);
						}
					}
               
				});
			 }
           $.ajax({
                dataType: "json",
                url: 'l285.aspx',
                success: OnRequestReady
            });
        }
        var blinkMode = false;
        function Blinker() {
            blinkMode = !blinkMode;


            var j;
            for (j = 0; j < stanki.length; j++) {

                rect = stanki[j];
                if (rect.blink == true) {
                    if (blinkMode) {
                        rect.setStyle({  fillOpacity: 0.1 });
                    } else {
                        rect.setStyle({  fillOpacity: 0.5});
                    }
                }
               
            }
           

        }

        ReloadData();

		var intervalID = window.setInterval(ReloadData, 1000);
		var intervalID2 = window.setInterval(Blinker, 500);
   

</script>
 
</body>
</html>
