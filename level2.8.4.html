<html>
<head>
	<meta charset="UTF-8">
	<title>Каменогорск. Уровень 2. Блок водоподготовки</title>
	<link rel="stylesheet" href="/leaflet.css" />
<link rel="stylesheet" href="/css/areal.css" />
	<script src="/leaflet.js" type="text/javascript"></script>
	<script src="./dist/PruneCluster.js" type="text/javascript"></script>
	<script src="./layer/Marker.Text.js" type="text/javascript"></script>
	<script src="./jquery-2.1.1.min.js" type="text/jscript"></script>
	
	<script src="./draw/src/leaflet.circle.topolygon-src.js"></script>
	<script src="./draw/src/Leaflet.draw.js"></script>
    <script src="./draw/src/Leaflet.Draw.Event.js"></script>
    <link rel="stylesheet" href="./draw/src/leaflet.draw.css"/>

    <script src="./draw/src/Toolbar.js"></script>
    <script src="./draw/src/Tooltip.js"></script>

    <script src="./draw/src/ext/GeometryUtil.js"></script>
    <script src="./draw/src/ext/LatLngUtil.js"></script>
    <script src="./draw/src/ext/LineUtil.Intersect.js"></script>
    <script src="./draw/src/ext/Polygon.Intersect.js"></script>
    <script src="./draw/src/ext/Polyline.Intersect.js"></script>
    <script src="./draw/src/ext/TouchEvents.js"></script>

    <script src="./draw/src/draw/DrawToolbar.js"></script>
    <script src="./draw/src/draw/handler/Draw.Feature.js"></script>
    <script src="./draw/src/draw/handler/Draw.SimpleShape.js"></script>
    <script src="./draw/src/draw/handler/Draw.Polyline.js"></script>
    <script src="./draw/src/draw/handler/Draw.Circle.js"></script>
    <script src="./draw/src/draw/handler/Draw.Marker.js"></script>
    <script src="./draw/src/draw/handler/Draw.Polygon.js"></script>
    <script src="./draw/src/draw/handler/Draw.Rectangle.js"></script>


    <script src="./draw/src/edit/EditToolbar.js"></script>
    <script src="./draw/src/edit/handler/EditToolbar.Edit.js"></script>
    <script src="./draw/src/edit/handler/EditToolbar.Delete.js"></script>

    <script src="./draw/src/Control.Draw.js"></script>

    <script src="./draw/src/edit/handler/Edit.Poly.js"></script>
    <script src="./draw/src/edit/handler/Edit.SimpleShape.js"></script>
    <script src="./draw/src/edit/handler/Edit.Circle.js"></script>
    <script src="./draw/src/edit/handler/Edit.Rectangle.js"></script>
    <script src="./draw/src/edit/handler/Edit.Marker.js"></script>
	
	
	<script src="./dist/easy-button.js" type="text/javascript"></script>
	<link rel="stylesheet" href="./dist/easy-button.css"/>
	<script src="./dist/jQuery.print.js" type="text/javascript"></script>
	
	
</head>
<body oncontextmenu="return false">
	<div style="position:absolute; top:0px; left:0px; height:30px; width:1000px; background: #bfbfbf; padding:10px; overflow-y: scroll;" id="brief"><table border="0"><tr>	<td width="90px" ><span id="vP1">?</span></td>	<td width="90px" ><span id="vP2">?</span></td>	<td width="90px" ><span id="vP3">?</span></td>	<td width="90px" ><span id="vP4">?</span></td>	<td width="90px" ><span id="vP5">?</span></td>	<td width="90px" ><span id="vP6">?</span></td>	<td width="90px" ><span id="vP7">?</span></td>	<td width="90px" ><span id="vP8">?</span></td>	<td width="90px" ><span id="vP9">?</span></td>	<td width="90px" ><span id="vP0">?</span></td>	</tr></table>	</div>	<div style="position:absolute; width:1000px; bottom:0px; top:50px;" id="map"></div>
	<div style="position:absolute; width:990px; bottom:0px; top:0px; left:0px; background: #aeaeae; padding:10px; display:none; z-index:1200; "  id="detail">
		<h1><a href="#" onclick=' $("#detail").hide(); return false;' ><img src="images/close.png" alt="Закрыть" border="0" width="30px" height="30px" /></a> Детальная информация</h1>
		<hr>
		<div id="detail_info">
		</div>
	</div>
	<div style="position:absolute; top:0px; left:1008px; right:0px; bottom:0px; background: #bfbfbf; padding:10px; overflow-y: scroll;" id="brief">
<h1>
	<a href="level1.html"><img src="images\home.png" alt="Главный экран" width="50px"; height="50px"; /></a>
	<img src="/images/areal.logo.png" border="0"; width="250px"; height="50px";  align="right" />
	</h1>
	<a href="level2.8.html"><h2>Блок водоподготовки</h2></a>
	<h2>Подсистема 4 (ШУ1, ШУ2)</h2>
	<!-- 
	<h3> Датчики </h3>
	<ul>
	<li><a href="#" onclick='GetDitail("84.41");'>FE2a : <span id="v84.41">?</span></a></li>
	
	</ul>
	-->
	
	<h3> Управление </h3>
	<ul>
	<li><a href="#" onclick='GetDitail("84.23");'>Задвижка 3.1M1 : <span id="v84.23">?</span></a></li>
	<li><a href="#" onclick='GetDitail("84.21");'>Задвижка 3.1M2 : <span id="v84.21">?</span></a></li>
	<li><a href="#" onclick='GetDitail("84.22");'>Задвижка 3.1M3 : <span id="v84.22">?</span></a></li>
	<li><a href="#" onclick='GetDitail("84.24");'>Задвижка 3.1M4 : <span id="v84.24">?</span></a></li>
	<li><a href="#" onclick='GetDitail("84.25");'>Задвижка 3.1M5 : <span id="v84.25">?</span></a></li>
	
	<li><a href="#" onclick='GetDitail("84.28");'>Задвижка 3.2M1 : <span id="v84.28">?</span></a></li>
	<li><a href="#" onclick='GetDitail("84.26");'>Задвижка 3.2M2 : <span id="v84.26">?</span></a></li>
	<li><a href="#" onclick='GetDitail("84.27");'>Задвижка 3.2M3 : <span id="v84.27">?</span></a></li>
	<li><a href="#" onclick='GetDitail("84.29");'>Задвижка 3.2M4  : <span id="v84.29">?</span></a></li>
	<li><a href="#" onclick='GetDitail("84.30");'>Задвижка 3.2M5  : <span id="v84.30">?</span></a></li>
	
	<li><a href="#" onclick='GetDitail("84.33");'>Задвижка 3.3M1  : <span id="v84.33">?</span></a></li>
	<li><a href="#" onclick='GetDitail("84.31");'>Задвижка 3.3M2  : <span id="v84.31">?</span></a></li>
	<li><a href="#" onclick='GetDitail("84.32");'>Задвижка 3.3M3  : <span id="v84.32">?</span></a></li>
	<li><a href="#" onclick='GetDitail("84.34");'>Задвижка 3.3M4  : <span id="v84.34">?</span></a></li>
	<li><a href="#" onclick='GetDitail("84.35");'>Задвижка 3.3M5  : <span id="v84.35">?</span></a></li>
	</ul>
	
	<hr>
	<span id="v206"></span><br/>
	<span id="v207"></span><br/>
	<span id="v208"></span><br/>
	<span id="v209"></span><br/>
	
	</div>
<script type='text/javascript'>
function GetDitail(sid){
 return; 

	$("#detail").show(); 
	var item=document.getElementById('detail_info');
	if( item!=null){
		item.innerHTML =sid;
	}else{
		console.log(v.ID);
	}
	return false;
}
	var imgW=1327;
	var imgH=625;

	var imageUrl = './images/l2_8.4.png', imageBounds = [[-imgH/20, -imgW/20], [imgH/20, imgW/20]];
	
	var map = L.map('map', { minZoom: 2, maxZoom: 7,attributionControl:false});  //.setView([27, 44], 3);
    map.attributionControl = false;
    L.imageOverlay(imageUrl, imageBounds, { opacity: 1 }).addTo(map); // , attribution: 'Цех:<%=GetC()%>'
	map.setView([0, 0], 4);
	map.fitBounds(imageBounds);
	map.setMaxBounds([[-imgH/15, -imgW/15], [imgH/15, imgW/15]])
		L.easyButton({
	  id: 'id-map-print',  // an id for the generated button
	  position: 'topleft',      // inherited from L.Control -- the corner it goes in
	  type: 'replace',          // set to animate when you're comfy with css
	  leafletClasses: true,     // use leaflet classes to style the button?
	  states:[{                 // specify different icons and responses for your button
		stateName: 'map-print',
		onClick: function(button, map){
			$('#map').print();
		},
		title: 'Печать',
		icon: '<img src="/images/print.png" width="18px;" height="18px">'
	  }]
	}).addTo( map );
	
	/* var  drawnItems = L.featureGroup().addTo(map);
	
	
    map.addControl(new L.Control.Draw({
        edit: {
            featureGroup: drawnItems,
            poly: {
                allowIntersection: false
            }
        },
        draw: {
            polygon: {
                allowIntersection: false,
                showArea: true
            }
        }
    }));
	*/
	
	

	var rgb = '#00FF00'; // green
	var bounds;
    map.on(L.Draw.Event.CREATED, function (event) {
        var layer = event.layer;
        var s ="";
		if(typeof layer.toPolygon =='undefined'){
			s= JSON.stringify(layer.toGeoJSON()) ;
			drawnItems.addLayer(layer);
		}else{
			
			//alert ( JSON.stringify(layer.toPolygon(24,map)) );
			bounds=layer.toPolygon(24,map);
			var player= L.polygon( bounds, {  color: rgb, opacity: 1.0, fillOpacity: 1, weight: 1 } );
			s= JSON.stringify(player.toGeoJSON());
			drawnItems.addLayer(player);
		}
		
		$.ajax({
		  type: 'GET',
		  url: 'savelayer.aspx',
		  data: 'P=l2_84&L=' +s,
		  success: function(data){
			//$('.results').html(data);
		  }
		});
		
    });
	
	
	
	
	
	
	map.on('contextmenu',function(event){ }); 
 var stanki =[];
	var blink=true;
	  
	    function MapX(X) {
            var mx = parseInt(X);
            mx = mx / 10 -imgW/20;
            return mx;
        }

        function MapY(Y) {
            var my = parseInt(Y);
            my =  imgH/20 - my / 10;
            return my;
        }
	
	var rect;
	var bounds;
	var rgb = '#dddddd';
	var marker;
	
	function RCW(deviceID, QReg, Reg1, Bit1, Val1, Reg2, Bit2, Val2) {
	    $.ajax({
	        dataType: "json",
	        type: 'POST',
	        url: 'rcw.aspx',
	        data: 'id=' + deviceID + '&qreg=' + QReg + '&reg1=' + Reg1 + '&bit1=' + Bit1 + '&val1=' + Val1 + '&reg2=' + Reg2 + '&bit2=' + Bit2 + '&val2=' + Val2,
	        success: function (data) {
	            map.closePopup();
	        }
	    });
	}
	
	bounds=FlipLL([[-56.653258770183434,16.175529464325166,0],[-56.865234073290736,16.08772641888997,0],[-57.047261392720905,15.948051944141739,0],[-57.18693586746914,15.766024624711571,0],[-57.27473891290433,15.55404932160427,0],[-57.304686896581465,15.326571801420842,0],[-57.27473891290433,15.099094281237416,0],[-57.18693586746914,14.887118978130113,0],[-57.047261392720905,14.705091658699946,0],[-56.865234073290736,14.565417183951713,0],[-56.653258770183434,14.47761413851652,0],[-56.42578125000001,14.447666154839384,0],[-56.19830372981658,14.47761413851652,0],[-55.98632842670928,14.565417183951713,0],[-55.80430110727911,14.705091658699947,0],[-55.664626632530876,14.887118978130113,0],[-55.57682358709568,15.099094281237416,0],[-55.54687560341855,15.326571801420842,0],[-55.57682358709568,15.554049321604268,0],[-55.664626632530876,15.76602462471157,0],[-55.80430110727911,15.948051944141737,0],[-55.98632842670928,16.08772641888997,0],[-56.19830372981658,16.175529464325162,0],[-56.653258770183434,16.175529464325166,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '84.21';
	rect.bindPopup(
	'<h3>Задвижка 3.1М2</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW(392,2,351,4,0,351,3,1);"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png" onclick="RCW(392,2,351,3,0,351,4,1);"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png" onclick="RCW(392,2,351,4,0,351,3,0);"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.1М2');
	rect.on('contextmenu',function(event){ }); 
    rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	 
	
	bounds=FlipLL([[-52.675432954773086,13.575863443120687,0],[-52.866210784979174,13.496840678449214,0],[-53.03003542176499,13.371133613347606,0],[-53.1557424868666,13.207308976561787,0],[-53.23476525153808,13.016531146355701,0],[-53.26171844495834,12.811801316582619,0],[-53.23476525153808,12.607071486809538,0],[-53.1557424868666,12.41629365660345,0],[-53.03003542176499,12.252469019817632,0],[-52.866210784979174,12.126761954716024,0],[-52.675432954773086,12.04773919004455,0],[-52.47070312500001,12.020785996624282,0],[-52.26597329522693,12.04773919004455,0],[-52.07519546502084,12.126761954716024,0],[-51.91137082823502,12.252469019817633,0],[-51.785663763133414,12.41629365660345,0],[-51.706640998461936,12.607071486809538,0],[-51.679687805041674,12.811801316582619,0],[-51.706640998461936,13.0165311463557,0],[-51.785663763133414,13.207308976561787,0],[-51.91137082823502,13.371133613347604,0],[-52.07519546502084,13.496840678449214,0],[-52.26597329522692,13.575863443120687,0],[-52.675432954773086,13.575863443120687,0]]) ;
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '84.22';
	rect.bindPopup(
	'<h3>Задвижка 3.1М3</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW( 392 , 2, 351 , 7 , 0 , 351 , 6 , 1 );"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW( 392 , 2, 351 , 6 , 0 , 351 , 7 , 1 );"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW( 392 , 2, 351 , 7 , 0 , 351 , 6 , 0 );"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.1М3');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	bounds=FlipLL([[-44.481536049360805,2.742476520235292,0],[-44.69456326545067,2.654237758176288,0],[-44.87749388303718,2.5138701583744942,0],[-45.017861482838974,2.3309395407879765,0],[-45.10610024489798,2.1179123246981164,0],[-45.13619684340132,1.8893059628373188,0],[-45.10610024489798,1.6606996009765211,0],[-45.017861482838974,1.447672384886661,0],[-44.87749388303718,1.2647417673001429,0],[-44.69456326545067,1.124374167498349,0],[-44.481536049360805,1.036135405439345,0],[-44.25292968750001,1.0060388069360031,0],[-44.02432332563921,1.036135405439345,0],[-43.811296109549346,1.1243741674983494,0],[-43.62836549196283,1.2647417673001433,0],[-43.48799789216104,1.447672384886661,0],[-43.399759130102034,1.660699600976521,0],[-43.36966253159869,1.8893059628373183,0],[-43.399759130102034,2.117912324698116,0],[-43.48799789216104,2.3309395407879756,0],[-43.62836549196283,2.513870158374494,0],[-43.811296109549346,2.6542377581762873,0],[-44.02432332563921,2.7424765202352916,0],[-44.481536049360805,2.742476520235292,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '84.23';
	rect.bindPopup(
	'<h3>Задвижка 3.1М1</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW( 392 , 2, 351 , 1 , 0 , 351 , 0 , 1 );"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW( 392 , 2, 351 , 0 , 0 , 351 , 1 , 1 );"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW( 392 , 2, 351 , 0 , 0 , 351 , 1 , 0 );"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.1М1');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	 
	
	bounds=FlipLL([[-34.25132464172403,14.176663274388144,0],[-34.4318312530594,14.101894987875026,0],[-34.58683579424488,13.982955820164115,0],[-34.70577496195578,13.827951278978642,0],[-34.7805432484689,13.647444667643278,0],[-34.80604531861879,13.453737213419249,0],[-34.7805432484689,13.260029759195222,0],[-34.70577496195578,13.079523147859858,0],[-34.58683579424488,12.924518606674383,0],[-34.4318312530594,12.805579438963472,0],[-34.25132464172403,12.730811152450354,0],[-34.05761718750001,12.705309082300465,0],[-33.86390973327598,12.730811152450354,0],[-33.683403121940614,12.805579438963472,0],[-33.52839858075514,12.924518606674383,0],[-33.40945941304423,13.079523147859858,0],[-33.33469112653111,13.260029759195222,0],[-33.30918905638122,13.453737213419249,0],[-33.33469112653111,13.647444667643276,0],[-33.40945941304423,13.82795127897864,0],[-33.52839858075514,13.982955820164115,0],[-33.683403121940614,14.101894987875026,0],[-33.863909733275975,14.176663274388144,0],[-34.25132464172403,14.176663274388144,0]]) ;
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '84.24';
	rect.bindPopup(
	'<h3>Задвижка 3.1М4</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW( 392 , 2, 351 , 10 , 0 , 351 , 9 , 1 );"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW( 392 , 2, 351 , 9 , 0 , 351 , 10 , 1 );"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW( 392 , 2, 351 , 9 , 0 , 351 , 10 , 0 );"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.1М4');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	
	bounds=FlipLL([[-32.50958741735775,11.357141884712407,0],[-32.705073800858045,11.276168773407317,0],[-32.87294176402186,11.147359154854662,0],[-33.00175138257452,10.979491191690844,0],[-33.08272449387961,10.78400480819055,0],[-33.11034291421608,10.574222078332806,0],[-33.08272449387961,10.364439348475061,0],[-33.00175138257452,10.16895296497477,0],[-32.87294176402186,10.00108500181095,0],[-32.705073800858045,9.872275383258295,0],[-32.50958741735775,9.791302271953205,0],[-32.29980468750001,9.763683851616731,0],[-32.090021957642264,9.791302271953205,0],[-31.89453557414197,9.872275383258295,0],[-31.72666761097815,10.001085001810951,0],[-31.597857992425496,10.16895296497477,0],[-31.516884881120408,10.364439348475061,0],[-31.48926646078393,10.574222078332806,0],[-31.516884881120408,10.78400480819055,0],[-31.597857992425496,10.979491191690842,0],[-31.72666761097815,11.14735915485466,0],[-31.89453557414197,11.276168773407317,0],[-32.090021957642264,11.357141884712407,0],[-32.50958741735775,11.357141884712407,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '84.25';
	rect.bindPopup(
	'<h3>Задвижка 3.1М5</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW( 392 , 2, 351 , 13 , 0 , 351 , 12 , 1 );"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW( 392 , 2, 351 , 12 , 0 , 351 , 13 , 1 );"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW( 392 , 2, 351 , 12 , 0 , 351 , 13 , 0 );"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.1М5');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	 
	
	bounds=FlipLL([[-15.467837499154202,16.18557509203869,0],[-15.671739744114003,16.10111601677802,0],[-15.846834571349786,15.96676103038449,0],[-15.981189557743315,15.791666203148706,0],[-16.06564863300399,15.587763958188905,0],[-16.094456050728006,15.368949896534705,0],[-16.06564863300399,15.150135834880505,0],[-15.981189557743317,14.946233589920704,0],[-15.846834571349786,14.77113876268492,0],[-15.671739744114003,14.636783776291391,0],[-15.467837499154202,14.55232470103072,0],[-15.249023437500002,14.523517283306703,0],[-15.030209375845802,14.55232470103072,0],[-14.826307130886,14.636783776291391,0],[-14.651212303650217,14.77113876268492,0],[-14.516857317256687,14.946233589920704,0],[-14.432398241996017,15.150135834880505,0],[-14.403590824272,15.368949896534705,0],[-14.432398241996017,15.587763958188905,0],[-14.516857317256687,15.791666203148706,0],[-14.651212303650217,15.96676103038449,0],[-14.826307130885999,16.10111601677802,0],[-15.0302093758458,16.18557509203869,0],[-15.467837499154202,16.18557509203869,0]]) ;
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '84.26';
	rect.bindPopup(
	'<h3>Задвижка 3.2М2</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW(392,2,352,4,0,351,3,1);"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW(392,2,352,3,0,351,4,1);"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW(392,2,352,4,0,351,3,0);"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.2М2');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	
	bounds=FlipLL([[-11.710076571804267,13.66594488577913,0],[-11.934047125171617,13.573173245002167,0],[-12.126374999518909,13.425594876474864,0],[-12.273953368046211,13.233267002127572,0],[-12.366725008823174,13.009296448760223,0],[-12.398367687843235,12.768946439455956,0],[-12.366725008823174,12.52859643015169,0],[-12.273953368046211,12.304625876784339,0],[-12.126374999518909,12.112298002437047,0],[-11.934047125171617,11.964719633909745,0],[-11.710076571804267,11.871947993132782,0],[-11.4697265625,11.84030531411272,0],[-11.229376553195733,11.871947993132782,0],[-11.005405999828382,11.964719633909745,0],[-10.813078125481091,12.112298002437049,0],[-10.665499756953789,12.304625876784339,0],[-10.572728116176826,12.528596430151689,0],[-10.541085437156765,12.768946439455956,0],[-10.572728116176826,13.009296448760221,0],[-10.665499756953789,13.233267002127572,0],[-10.813078125481091,13.425594876474863,0],[-11.005405999828382,13.573173245002165,0],[-11.229376553195731,13.66594488577913,0],[-11.710076571804267,13.66594488577913,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '84.27';
	rect.bindPopup(
	'<h3>Задвижка 3.2М3</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW(392,2,352,7,0,351,6,1);"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW(392,2,352,6,0,351,7,1);"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW(392,2,352,6,0,351,7,0);"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.2М3');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	 
	
	bounds=FlipLL([[-3.2812565580476445,2.6107704455611547,0],[-3.472365058864055,2.5316107126382077,0],[-3.6364736489403238,2.40568576251351,0],[-3.762398599065021,2.2415771724372417,0],[-3.841558331987968,2.0504686716208314,0],[-3.8685582427281098,1.8453839885731873,0],[-3.841558331987968,1.6402993055255433,0],[-3.762398599065021,1.4491908047091326,0],[-3.6364736489403238,1.285082214632864,0],[-3.472365058864055,1.1591572645081667,0],[-3.2812565580476445,1.0799975315852197,0],[-3.076171875,1.052997620845078,0],[-2.871087191952356,1.07999753158522,0],[-2.6799786911359456,1.159157264508167,0],[-2.5158701010596767,1.2850822146328642,0],[-2.38994515093498,1.4491908047091329,0],[-2.310785418012033,1.640299305525543,0],[-2.283785507271891,1.8453839885731869,0],[-2.310785418012033,2.050468671620831,0],[-2.3899451509349796,2.241577172437241,0],[-2.5158701010596767,2.4056857625135097,0],[-2.679978691135945,2.531610712638207,0],[-2.871087191952355,2.610770445561154,0],[-3.2812565580476445,2.6107704455611547,0]]) ;
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '84.28';
	rect.bindPopup(
	'<h3>Задвижка 3.2М1</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW(392,2,352,1,0,351,0,1);"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW(392,2,352,0,0,351,1,1);"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW(392,2,352,0,0,351,1,0);"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.2М1');
	rect.on('contextmenu',function(event){ }); 
	rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	
	bounds=FlipLL([[6.941876510365155,14.322037586939414,0],[6.735742140123686,14.23665393511416,0],[6.558730543454397,14.10082815980457,0],[6.422904768144804,13.92381656313528,0],[6.337521116319551,13.717682192893811,0],[6.308398342747371,13.496472765758964,0],[6.33752111631955,13.27526333862412,0],[6.422904768144804,13.06912896838265,0],[6.558730543454397,12.89211737171336,0],[6.735742140123686,12.756291596403768,0],[6.941876510365155,12.670907944578515,0],[7.163085937500001,12.641785171006335,0],[7.3842953646348475,12.670907944578515,0],[7.590429734876317,12.756291596403768,0],[7.767441331545606,12.892117371713361,0],[7.903267106855198,13.06912896838265,0],[7.988650758680451,13.275263338624118,0],[8.017773532252631,13.496472765758964,0],[7.988650758680452,13.71768219289381,0],[7.903267106855198,13.92381656313528,0],[7.767441331545606,14.100828159804568,0],[7.590429734876317,14.23665393511416,0],[7.384295364634848,14.322037586939414,0],[6.941876510365155,14.322037586939414,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '84.29';
	rect.bindPopup(
	'<h3>Задвижка 3.2М4</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW(392,2,352,10,0,351,9,1);"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW(392,2,352,9,0,351,10,1);"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW(392,2,352,9,0,351,10,0);"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.2М4');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
		
	bounds=FlipLL([[8.638435636137027,11.343571315876169,0],[8.457123232047463,11.2684692590758,0],[8.301426740937101,11.148999139513194,0],[8.181956621374495,10.993302648402832,0],[8.106854564574126,10.811990244313268,0],[8.081238651594925,10.617418067950293,0],[8.106854564574126,10.422845891587318,0],[8.181956621374495,10.241533487497755,0],[8.301426740937101,10.085836996387393,0],[8.457123232047463,9.966366876824786,0],[8.638435636137027,9.891264820024418,0],[8.833007812500002,9.865648907045216,0],[9.027579988862977,9.891264820024418,0],[9.20889239295254,9.966366876824786,0],[9.364588884062902,10.085836996387393,0],[9.48405900362551,10.241533487497755,0],[9.559161060425877,10.422845891587318,0],[9.584776973405079,10.617418067950293,0],[9.559161060425877,10.811990244313268,0],[9.48405900362551,10.993302648402832,0],[9.364588884062902,11.148999139513194,0],[9.208892392952542,11.2684692590758,0],[9.027579988862978,11.343571315876169,0],[8.638435636137027,11.343571315876169,0]]) ;
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '84.30';
	rect.bindPopup(
	'<h3>Задвижка 3.2М5</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW(392,2,352,13,0,351,12,1);"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW(392,2,352,12,0,351,13,1);"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW(392,2,352,12,0,351,13,0);"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.2М5');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	
	bounds=FlipLL([[25.796116133729733,16.188168138167185,0],[25.59156643394023,16.10344087833503,0],[25.415915624637787,15.968659271896918,0],[25.281134018199676,15.793008462594475,0],[25.19640675836752,15.588458762804972,0],[25.167507867880463,15.368949896534705,0],[25.19640675836752,15.149441030264438,0],[25.281134018199676,14.944891330474936,0],[25.415915624637787,14.769240521172492,0],[25.59156643394023,14.634458914734381,0],[25.796116133729733,14.549731654902224,0],[26.015625,14.520832764415166,0],[26.235133866270267,14.549731654902224,0],[26.43968356605977,14.634458914734381,0],[26.615334375362213,14.769240521172492,0],[26.750115981800324,14.944891330474936,0],[26.83484324163248,15.149441030264438,0],[26.863742132119537,15.368949896534705,0],[26.83484324163248,15.588458762804972,0],[26.750115981800324,15.793008462594473,0],[26.615334375362213,15.968659271896916,0],[26.43968356605977,16.10344087833503,0],[26.235133866270267,16.188168138167185,0],[25.796116133729733,16.188168138167185,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '84.31';
	rect.bindPopup(
	'<h3>Задвижка 3.3М2</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  	onclick="RCW(393,2,351,4,0,351,3,1);"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png" 		onclick="RCW(393,2,351,3,0,351,4,1);"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png" 		onclick="RCW(393,2,351,4,0,351,3,0);"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.3М2');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	 
	
	bounds=FlipLL([[29.53021121506941,13.63570880974419,0],[29.324490661234226,13.550496566286752,0],[29.147834416769026,13.414943462313596,0],[29.01228131279587,13.238287217848399,0],[28.927069069338433,13.032566664013213,0],[28.898004759968444,12.811801316582619,0],[28.927069069338433,12.591035969152026,0],[29.01228131279587,12.38531541531684,0],[29.147834416769026,12.208659170851641,0],[29.324490661234226,12.073106066878486,0],[29.53021121506941,11.987893823421048,0],[29.750976562500004,11.958829514051061,0],[29.971741909930596,11.987893823421048,0],[30.17746246376578,12.073106066878486,0],[30.35411870823098,12.208659170851641,0],[30.489671812204136,12.38531541531684,0],[30.574884055661574,12.591035969152026,0],[30.603948365031563,12.811801316582619,0],[30.574884055661574,13.032566664013212,0],[30.489671812204136,13.238287217848397,0],[30.35411870823098,13.414943462313595,0],[30.177462463765785,13.550496566286752,0],[29.9717419099306,13.63570880974419,0],[29.53021121506941,13.63570880974419,0]]) ;
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '84.32';
	rect.bindPopup(
	'<h3>Задвижка 3.3М3</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  	onclick="RCW(393,2,351,7,0,351,6,1);"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png" 		onclick="RCW(393,2,351,6,0,351,7,1);"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png" 		onclick="RCW(393,2,351,6,0,351,7,0);"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.3М3');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	bounds=FlipLL([[37.83262516246285,2.7253430507070555,0],[37.623875983494536,2.6388763096441323,0],[37.44461899966743,2.5013275881698918,0],[37.307070278193194,2.3220706043427937,0],[37.22060353713027,2.1133214253744823,0],[37.19111134198906,1.8893059628373188,0],[37.22060353713027,1.6652905003001552,0],[37.307070278193194,1.4565413213318437,0],[37.44461899966743,1.2772843375047453,0],[37.623875983494536,1.1397356160305048,0],[37.83262516246285,1.0532688749675816,0],[38.05664062500001,1.0237766798263683,0],[38.280656087537174,1.0532688749675818,0],[38.489405266505486,1.139735616030505,0],[38.66866225033258,1.2772843375047458,0],[38.80621097180682,1.4565413213318439,0],[38.89267771286974,1.665290500300155,0],[38.92216990801096,1.8893059628373183,0],[38.89267771286974,2.113321425374482,0],[38.80621097180682,2.322070604342793,0],[38.66866225033258,2.5013275881698913,0],[38.489405266505486,2.6388763096441314,0],[38.280656087537174,2.725343050707055,0],[37.83262516246285,2.7253430507070555,0]]) ;
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '84.33';
	rect.bindPopup(
	'<h3>Задвижка 3.3М1</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  	onclick="RCW(393,2,351,1,0,351,0,1);"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png" 		onclick="RCW(393,2,351,0,0,351,1,1);"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png" 		onclick="RCW(393,2,351,0,0,351,1,0);"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.3М1');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	bounds=FlipLL([[48.166530152608125,14.22181532443522,0],[47.96407707838805,14.13795651534914,0],[47.79022668227836,14.004556414543341,0],[47.656826581472565,13.830706018433652,0],[47.572967772386484,13.62825294421358,0],[47.5443650942761,13.410994034321702,0],[47.572967772386484,13.193735124429823,0],[47.656826581472565,12.991282050209753,0],[47.79022668227836,12.817431654100062,0],[47.96407707838805,12.684031553294263,0],[48.166530152608125,12.600172744208184,0],[48.3837890625,12.571570066097802,0],[48.60104797239188,12.600172744208184,0],[48.80350104661195,12.684031553294263,0],[48.97735144272164,12.817431654100062,0],[49.110751543527435,12.991282050209753,0],[49.194610352613516,13.193735124429823,0],[49.2232130307239,13.410994034321702,0],[49.194610352613516,13.62825294421358,0],[49.110751543527435,13.83070601843365,0],[48.97735144272164,14.004556414543341,0],[48.80350104661195,14.137956515349138,0],[48.60104797239188,14.22181532443522,0],[48.166530152608125,14.22181532443522,0]]) ;
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '84.34';
	rect.bindPopup(
	'<h3>Задвижка 3.3М4</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  	onclick="RCW(393,2,351,10,0,351,9,1);"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png" 		onclick="RCW(393,2,351,9,0,351,10,1);"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png" 		onclick="RCW(393,2,351,9,0,351,10,0);"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.3М4');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	bounds=FlipLL([[49.892926396017266,11.295082225354731,0],[49.70214854325137,11.21605945133868,0],[49.53832388709301,11.09035237137199,0],[49.41261680712632,10.926527715213625,0],[49.333594033110266,10.735749862447728,0],[49.30664083650274,10.531020008464989,0],[49.333594033110266,10.32629015448225,0],[49.41261680712632,10.135512301716352,0],[49.53832388709301,9.971687645557987,0],[49.70214854325137,9.845980565591297,0],[49.892926396017266,9.766957791575246,0],[50.09765625000001,9.740004594967715,0],[50.30238610398275,9.766957791575246,0],[50.493163956748646,9.845980565591299,0],[50.65698861290701,9.971687645557987,0],[50.782695692873695,10.135512301716352,0],[50.86171846688975,10.32629015448225,0],[50.88867166349728,10.531020008464989,0],[50.86171846688975,10.735749862447728,0],[50.782695692873695,10.926527715213624,0],[50.65698861290701,11.09035237137199,0],[50.493163956748646,11.216059451338678,0],[50.30238610398275,11.29508222535473,0],[49.892926396017266,11.295082225354731,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '84.35';
	rect.bindPopup(
	'<h3>Задвижка 3.3М5</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  	onclick="RCW(393,2,351,13,0,351,12,1);"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png" 		onclick="RCW(393,2,351,12,0,351,13,1);"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png" 		onclick="RCW(393,2,351,12,0,351,13,0);"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3.3М5');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	/*
	bounds=FlipLL([[-56.92637688752859,11.314260641159763,0],[-57.31095673548064,11.154962452322643,0],[-57.64120293776645,10.901555628631177,0],[-57.894609761457914,10.57130942634536,0],[-58.053907950295034,10.186729578393319,0],[-58.10824159596126,9.774024565864734,0],[-58.053907950295034,9.36131955333615,0],[-57.894609761457914,8.976739705384107,0],[-57.64120293776645,8.64649350309829,0],[-57.31095673548064,8.393086679406824,0],[-56.92637688752859,8.233788490569705,0],[-56.51367187500001,8.17945484490348,0],[-56.100966862471424,8.233788490569705,0],[-55.71638701451938,8.393086679406824,0],[-55.38614081223356,8.646493503098291,0],[-55.1327339885421,8.976739705384107,0],[-54.97343579970498,9.361319553336148,0],[-54.919102154038754,9.774024565864734,0],[-54.97343579970498,10.186729578393317,0],[-55.1327339885421,10.57130942634536,0],[-55.38614081223356,10.901555628631176,0],[-55.71638701451938,11.154962452322643,0],[-56.10096686247142,11.31426064115976,0],[-56.92637688752859,11.314260641159763,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '84.41';
	//rect.bindPopup('Датчик 1');
	rect.bindTooltip('Датчик 1');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	*/
	
	function FlipLL(b) {
		var fb;
		var point;
		var j;
		fb=[];
		for (j = 0; j < b.length; j++) {
			 point =new  L.latLng(
			  b[j][1],               
			  b[j][0],               
               b[j][2]             
            );
			fb.push(point)
		}
		return fb;
	}


    function ReloadData() {

              function OnRequestReady(data) {

                $.each(data.data, function (i, v) {
                    var ok = false;
                    var rect;
                    var j;
                    for (j = 0; j < stanki.length; j++) {
                        if (stanki[j].tag == v.ID) {
                            ok = true;
                            rect = stanki[j];
                            break;
                        }
                    }

                    if (ok) {
						if(v.BLINK=='YES'){
							blink=true;
						}else{
							blink=false;
						}
					
						switch (v.COLOR) {
							case 'GREEN':
								 rgb = '#00FF00'; // green
								break;
							case 'YELLOW':
								rgb = '#dddd00';
								break;
							case 'RED':
								 rgb = '#FF0000'; //red
								break;
							default:
								rgb = '#000000'; //black
								break;
						}
                        rect.setStyle({ color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 1 });
                       // //rect.bindPopup(sPopup);
                       // rect.marker.bindPopup(sPopup);
                        rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
					}
					if(v.INFO !=null){
						var item=document.getElementById('v' +v.ID);
						if( item!=null){
							item.innerHTML =v.INFO;
						}else{
							console.log(v.ID);
						}
					}
               
				});
			 }
           $.ajax({
                dataType: "json",
                url: 'l284.aspx',
                success: OnRequestReady
            });
        }
        var blinkMode = false;
        function Blinker() {
            blinkMode = !blinkMode;


            var j;
            for (j = 0; j < stanki.length; j++) {

                rect = stanki[j];
                if (rect.blink == true) {
                    if (blinkMode) {
                        rect.setStyle({  fillOpacity: 0.1 });
                    } else {
                        rect.setStyle({  fillOpacity: 0.5 });
                    }
                }
               
            }
           

        }

        ReloadData();
		var intervalID = window.setInterval(ReloadData, 1000);
		var intervalID2 = window.setInterval(Blinker, 500);
   

</script>
 
</body>
</html>
