<html>
<head>
	<meta charset="UTF-8">
	<title>Каменогорск. Уровень 2. Блок водоподготовки</title>
	<link rel="stylesheet" href="/leaflet.css" />
<link rel="stylesheet" href="/css/areal.css" />
	<script src="/leaflet.js" type="text/javascript"></script>
	<script src="./dist/PruneCluster.js" type="text/javascript"></script>
	<script src="./layer/Marker.Text.js" type="text/javascript"></script>
	<script src="./jquery-2.1.1.min.js" type="text/jscript"></script>
	
	<script src="./draw/src/leaflet.circle.topolygon-src.js"></script>
	<script src="./draw/src/Leaflet.draw.js"></script>
    <script src="./draw/src/Leaflet.Draw.Event.js"></script>
    <link rel="stylesheet" href="./draw/src/leaflet.draw.css"/>

    <script src="./draw/src/Toolbar.js"></script>
    <script src="./draw/src/Tooltip.js"></script>

    <script src="./draw/src/ext/GeometryUtil.js"></script>
    <script src="./draw/src/ext/LatLngUtil.js"></script>
    <script src="./draw/src/ext/LineUtil.Intersect.js"></script>
    <script src="./draw/src/ext/Polygon.Intersect.js"></script>
    <script src="./draw/src/ext/Polyline.Intersect.js"></script>
    <script src="./draw/src/ext/TouchEvents.js"></script>

    <script src="./draw/src/draw/DrawToolbar.js"></script>
    <script src="./draw/src/draw/handler/Draw.Feature.js"></script>
    <script src="./draw/src/draw/handler/Draw.SimpleShape.js"></script>
    <script src="./draw/src/draw/handler/Draw.Polyline.js"></script>
    <script src="./draw/src/draw/handler/Draw.Circle.js"></script>
    <script src="./draw/src/draw/handler/Draw.Marker.js"></script>
    <script src="./draw/src/draw/handler/Draw.Polygon.js"></script>
    <script src="./draw/src/draw/handler/Draw.Rectangle.js"></script>


    <script src="./draw/src/edit/EditToolbar.js"></script>
    <script src="./draw/src/edit/handler/EditToolbar.Edit.js"></script>
    <script src="./draw/src/edit/handler/EditToolbar.Delete.js"></script>

    <script src="./draw/src/Control.Draw.js"></script>

    <script src="./draw/src/edit/handler/Edit.Poly.js"></script>
    <script src="./draw/src/edit/handler/Edit.SimpleShape.js"></script>
    <script src="./draw/src/edit/handler/Edit.Circle.js"></script>
    <script src="./draw/src/edit/handler/Edit.Rectangle.js"></script>
    <script src="./draw/src/edit/handler/Edit.Marker.js"></script>
	
	
	<script src="./dist/easy-button.js" type="text/javascript"></script>
	<link rel="stylesheet" href="./dist/easy-button.css"/>
	<script src="./dist/jQuery.print.js" type="text/javascript"></script>
	
	
</head>
<body oncontextmenu="return false">
	<div style="position:absolute; top:0px; left:0px; height:30px; width:1500px; background: #bfbfbf; padding:10px; overflow-y: scroll;" id="brief"><table border="0"><tr>	<td width="90px" ><span id="vP1">?</span></td>	<td width="90px" ><span id="vP2">?</span></td>	<td width="90px" ><span id="vP3">?</span></td>	<td width="90px" ><span id="vP4">?</span></td>	<td width="90px" ><span id="vP5">?</span></td>	<td width="90px" ><span id="vP6">?</span></td>	<td width="90px" ><span id="vP7">?</span></td>	<td width="90px" ><span id="vP8">?</span></td>	<td width="90px" ><span id="vP9">?</span></td>	<td width="90px" ><span id="vP0">?</span></td>	</tr></table>	</div>	<div style="position:absolute; width:1500px; bottom:0px; top:50px;" id="map"></div>
	<div style="position:absolute; width:990px; bottom:0px; top:0px; left:0px; background: #aeaeae; padding:10px; display:none; z-index:1200; "  id="detail">
		<h1><a href="#" onclick=' $("#detail").hide(); return false;' ><img src="images/close.png" alt="Закрыть" border="0" width="30px" height="30px" /></a> Детальная информация</h1>
		<hr>
		<div id="detail_info">
		</div>
	</div>
	<div style="position:absolute; top:0px; left:1508px; right:0px; bottom:0px; background: #bfbfbf; padding:10px; overflow-y: scroll;" id="brief">
<h1>
	<a href="level1.html"><img src="images\home.png" alt="Главный экран" width="50px"; height="50px"; /></a>
	<img src="/images/areal.logo.png" border="0"; width="250px"; height="50px";  align="right" />
	</h1>
	<a href="level2.8.html"><h2>Блок водоподготовки</h2></a>
	<h2>Подсистема 6 (ШУ4,ШУ8)</h2>
	<!-- <h3> Датчики </h3>
	<ul>
	<li><a href="#" onclick='GetDitail("86.41");'>LT9a  : <span id="v86.41">?</span></a></li>
	<li><a href="#" onclick='GetDitail("86.42");'>FE14a : <span id="v86.42">?</span></a></li>
	<li><a href="#" onclick='GetDitail("86.43");'>LT15a : <span id="v86.43">?</span></a></li>
	<li><a href="#" onclick='GetDitail("86.44");'>FE20a : <span id="v86.44">?</span></a></li>
	<li><a href="#" onclick='GetDitail("86.45");'>    8 : <span id="v86.45">?</span></a></li>
	<li><a href="#" onclick='GetDitail("86.46");'>    9 : <span id="v86.46">?</span></a></li>
	<li><a href="#" onclick='GetDitail("86.47");'>   10 : <span id="v86.47">?</span></a></li>
	<li><a href="#" onclick='GetDitail("86.48");'>   20 : <span id="v86.48">?</span></a></li>
	<li><a href="#" onclick='GetDitail("86.49");'>   21 : <span id="v86.49">?</span></a></li>
	<li><a href="#" onclick='GetDitail("86.50");'>   22 : <span id="v86.50">?</span></a></li>
	</ul>
	-->
	
	<h3> Управление </h3>
	<ul>
	<li><a href="#" onclick='GetDitail("86.21");'>Задвижка 3M  : <span id="v86.21">?</span></a></li>
	<li><a href="#" onclick='GetDitail("86.22");'>Насос 2M1 : <span id="v86.22">?</span></a></li>
	<li><a href="#" onclick='GetDitail("86.23");'>Насос 2M2 : <span id="v86.23">?</span></a></li>
	<li><a href="#" onclick='GetDitail("86.24");'>Задвижка 4M  : <span id="v86.24">?</span></a></li>
	<li><a href="#" onclick='GetDitail("86.25");'>Насос 2M3 : <span id="v86.25">?</span></a></li>
	<li><a href="#" onclick='GetDitail("86.26");'>Насос 2M4 : <span id="v86.26">?</span></a></li>
	
	</ul>
	
		<hr>

	<span id="v214"></span><br/>
	<span id="v215"></span><br/>
	<span id="v216"></span><br/>
	<span id="v217"></span><br/>
	<span id="v218"></span><br/>
	<span id="v219"></span><br/>
	<span id="v220"></span><br/>
	<span id="v221"></span><br/>
	
	
	</div>
<script type='text/javascript'>
function GetDitail(sid){
 return; 

	$("#detail").show(); 
	var item=document.getElementById('detail_info');
	if( item!=null){
		item.innerHTML =sid;
	}else{
		console.log(v.ID);
	}
	return false;
}
	var imgW=756;
	var imgH=962;

	var imageUrl = './images/l2_8.6.png', imageBounds = [[-imgH/20, -imgW/20], [imgH/20, imgW/20]];
	
	var map = L.map('map', { minZoom: 2, maxZoom: 7,attributionControl:false});  //.setView([27, 44], 3);
    map.attributionControl = false;
    L.imageOverlay(imageUrl, imageBounds, { opacity: 1 }).addTo(map); // , attribution: 'Цех:<%=GetC()%>'
	map.setView([0, 0], 4);
	map.fitBounds(imageBounds);
	map.setMaxBounds([[-imgH/15, -imgW/15], [imgH/15, imgW/15]])
	
		L.easyButton({
	  id: 'id-map-print',  // an id for the generated button
	  position: 'topleft',      // inherited from L.Control -- the corner it goes in
	  type: 'replace',          // set to animate when you're comfy with css
	  leafletClasses: true,     // use leaflet classes to style the button?
	  states:[{                 // specify different icons and responses for your button
		stateName: 'map-print',
		onClick: function(button, map){
			$('#map').print();
		},
		title: 'Печать',
		icon: '<img src="/images/print.png" width="18px;" height="18px">'
	  }]
	}).addTo( map );
	
	/*
	 var  drawnItems = L.featureGroup().addTo(map);
	
	
    map.addControl(new L.Control.Draw({
        edit: {
            featureGroup: drawnItems,
            poly: {
                allowIntersection: false
            }
        },
        draw: {
            polygon: {
                allowIntersection: false,
                showArea: true
            }
        }
    }));
	
	
	*/

	var rgb = '#00FF00'; // green
	var bounds;
    map.on(L.Draw.Event.CREATED, function (event) {
        var layer = event.layer;
        var s ="";
		if(typeof layer.toPolygon =='undefined'){
			s= JSON.stringify(layer.toGeoJSON()) ;
			drawnItems.addLayer(layer);
		}else{
			
			//alert ( JSON.stringify(layer.toPolygon(24,map)) );
			bounds=layer.toPolygon(24,map);
			var player= L.polygon( bounds, {  color: rgb, opacity: 1.0, fillOpacity: 1, weight: 1 } );
			s= JSON.stringify(player.toGeoJSON());
			drawnItems.addLayer(player);
		}
		
		$.ajax({
		  type: 'GET',
		  url: 'savelayer.aspx',
		  data: 'P=l2_86&L=' +s,
		  success: function(data){
			//$('.results').html(data);
		  }
		});
		
    });
	
	
	
	
	
	
	map.on('contextmenu',function(event){ }); 
 var stanki =[];
	var blink=true;
	  
	    function MapX(X) {
            var mx = parseInt(X);
            mx = mx / 10 -imgW/20;
            return mx;
        }

        function MapY(Y) {
            var my = parseInt(Y);
            my =  imgH/20 - my / 10;
            return my;
        }
	
	var rect;
	var bounds;
	var rgb = '#dddddd';
	var marker;
	
		function RCW(deviceID, QReg, Reg1, Bit1, Val1, Reg2, Bit2, Val2) {
	    $.ajax({
	        dataType: "json",
	        type: 'POST',
	        url: 'rcw.aspx',
	        data: 'id=' + deviceID + '&qreg=' + QReg + '&reg1=' + Reg1 + '&bit1=' + Bit1 + '&val1=' + Val1 + '&reg2=' + Reg2 + '&bit2=' + Bit2 + '&val2=' + Val2,
	        success: function (data) {
	            map.closePopup();
	        }
	    });
	}
	
	/*
    bounds=FlipLL([[-24.22371736273737,39.07699987472513,0],[-24.519549849343814,38.95446204658219,0],[-24.773586964743394,38.759532511987764,0],[-24.96851649933782,38.50549539658818,0],[-25.091054327480766,38.20966290998174,0],[-25.13284969868762,37.89219554724437,0],[-25.091054327480766,37.574728184507,0],[-24.96851649933782,37.27889569790056,0],[-24.773586964743394,37.024858582500976,0],[-24.519549849343814,36.82992904790655,0],[-24.22371736273737,36.70739121976361,0],[-23.906250000000004,36.66559584855675,0],[-23.588782637262632,36.70739121976361,0],[-23.292950150656193,36.82992904790655,0],[-23.038913035256613,37.024858582500976,0],[-22.843983500662187,37.27889569790056,0],[-22.72144567251924,37.574728184507,0],[-22.679650301312385,37.89219554724437,0],[-22.72144567251924,38.20966290998174,0],[-22.843983500662187,38.50549539658818,0],[-23.03891303525661,38.759532511987764,0],[-23.292950150656193,38.95446204658219,0],[-23.588782637262632,39.07699987472513,0],[-24.22371736273737,39.07699987472513,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '86.41';
	//rect.bindPopup('Датчик 1');
	rect.bindTooltip('Датчик 1');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	 
	
	bounds=FlipLL([[-16.59626633377308,41.1992742038983,0],[-16.90983507533699,41.06938977840626,0],[-17.179102658150992,40.86277349512522,0],[-17.385718941432035,40.593505912311215,0],[-17.51560336692407,40.27993717074731,0],[-17.559904525673975,39.94343646197423,0],[-17.51560336692407,39.60693575320115,0],[-17.385718941432035,39.293367011637244,0],[-17.179102658150992,39.02409942882324,0],[-16.90983507533699,38.8174831455422,0],[-16.59626633377308,38.68759872005016,0],[-16.259765625000004,38.64329756130026,0],[-15.923264916226925,38.68759872005016,0],[-15.609696174663018,38.8174831455422,0],[-15.340428591849015,39.02409942882324,0],[-15.133812308567972,39.293367011637244,0],[-15.003927883075939,39.60693575320115,0],[-14.959626724326032,39.94343646197423,0],[-15.003927883075937,40.27993717074731,0],[-15.133812308567972,40.593505912311215,0],[-15.340428591849015,40.86277349512522,0],[-15.609696174663016,41.06938977840626,0],[-15.923264916226923,41.1992742038983,0],[-16.59626633377308,41.1992742038983,0]]) ;
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '86.42';
	//rect.bindPopup('Датчик 2');
	rect.bindTooltip('Датчик 2');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	bounds=FlipLL([[-25.595659245615344,-9.158994394147628,0],[-25.900472168660965,-9.285252040859712,0],[-26.162220959658484,-9.48609895226297,0],[-26.363067871061745,-9.747847743260488,0],[-26.48932551777383,-10.052660666306112,0],[-26.532389649821933,-10.379765224421455,0],[-26.48932551777383,-10.706869782536797,0],[-26.363067871061745,-11.011682705582421,0],[-26.162220959658484,-11.273431496579938,0],[-25.900472168660965,-11.474278407983197,0],[-25.595659245615344,-11.600536054695281,0],[-25.2685546875,-11.643600186743388,0],[-24.941450129384656,-11.600536054695281,0],[-24.63663720633903,-11.474278407983197,0],[-24.374888415341516,-11.273431496579938,0],[-24.174041503938255,-11.011682705582421,0],[-24.04778385722617,-10.706869782536797,0],[-24.004719725178067,-10.379765224421455,0],[-24.04778385722617,-10.052660666306112,0],[-24.174041503938255,-9.74784774326049,0],[-24.374888415341516,-9.486098952262973,0],[-24.63663720633903,-9.285252040859714,0],[-24.941450129384656,-9.158994394147628,0],[-25.595659245615344,-9.158994394147628,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '86.43';
	//rect.bindPopup('Датчик 3');
	rect.bindTooltip('Датчик 3');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	
	bounds=FlipLL([[-17.984027308218405,-6.480605723554481,0],[-18.28036702076463,-6.603353651560871,0],[-18.534839700953178,-6.798617406772883,0],[-18.73010345616519,-7.053090086961431,0],[-18.85285138417158,-7.349429799507654,0],[-18.89471841652925,-7.667441482726056,0],[-18.85285138417158,-7.985453165944457,0],[-18.73010345616519,-8.28179287849068,0],[-18.534839700953178,-8.53626555867923,0],[-18.28036702076463,-8.73152931389124,0],[-17.984027308218405,-8.85427724189763,0],[-17.666015625000004,-8.896144274255304,0],[-17.348003941781602,-8.85427724189763,0],[-17.051664229235378,-8.73152931389124,0],[-16.79719154904683,-8.536265558679228,0],[-16.601927793834818,-8.28179287849068,0],[-16.479179865828428,-7.985453165944458,0],[-16.437312833470756,-7.667441482726056,0],[-16.479179865828428,-7.3494297995076545,0],[-16.601927793834818,-7.053090086961432,0],[-16.79719154904683,-6.798617406772884,0],[-17.051664229235378,-6.603353651560871,0],[-17.3480039417816,-6.480605723554482,0],[-17.984027308218405,-6.480605723554481,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '86.44';
	//rect.bindPopup('Датчик 4');
	rect.bindTooltip('Датчик 4');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	bounds=FlipLL([[6.656864203678023,43.755770731002805,0],[6.3079921806736055,43.61126320754184,0],[6.008408982816222,43.38138493468083,0],[5.778530709955213,43.08180173682345,0],[5.634023186494245,42.73292971381903,0],[5.58473436134721,42.35854391749705,0],[5.634023186494244,41.98415812117507,0],[5.778530709955213,41.63528609817066,0],[6.008408982816222,41.33570290031327,0],[6.3079921806736055,41.105824627452265,0],[6.656864203678023,40.9613171039913,0],[7.031250000000002,40.91202827884426,0],[7.40563579632198,40.9613171039913,0],[7.754507819326397,41.105824627452265,0],[8.05409101718378,41.33570290031327,0],[8.283969290044789,41.63528609817066,0],[8.428476813505757,41.98415812117507,0],[8.477765638652793,42.35854391749705,0],[8.428476813505757,42.73292971381903,0],[8.28396929004479,43.081801736823444,0],[8.05409101718378,43.38138493468083,0],[7.754507819326398,43.61126320754184,0],[7.405635796321982,43.755770731002805,0],[6.656864203678023,43.755770731002805,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '86.45';
	//rect.bindPopup('Датчик 5');
	rect.bindTooltip('Датчик 5');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	 
	
	bounds=FlipLL([[17.857403547732133,43.48232157267105,0],[17.544342554899313,43.352647463589705,0],[17.27551098580535,43.14636574540317,0],[17.06922926761882,42.87753417630921,0],[16.93955515853748,42.56447318347639,0],[16.895325734798625,42.22851735620852,0],[16.93955515853748,41.892561528940654,0],[17.06922926761882,41.57950053610783,0],[17.27551098580535,41.31066896701387,0],[17.544342554899313,41.10438724882734,0],[17.857403547732133,40.974713139745994,0],[18.193359375000004,40.93048371600714,0],[18.529315202267874,40.974713139745994,0],[18.842376195100695,41.10438724882734,0],[19.11120776419466,41.31066896701387,0],[19.317489482381188,41.57950053610783,0],[19.447163591462527,41.892561528940654,0],[19.491393015201382,42.22851735620852,0],[19.447163591462527,42.56447318347639,0],[19.317489482381188,42.87753417630921,0],[19.11120776419466,43.14636574540317,0],[18.842376195100695,43.352647463589705,0],[18.529315202267874,43.48232157267105,0],[17.857403547732133,43.48232157267105,0]]) ;
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '86.46';
	//rect.bindPopup('Датчик 6');
	rect.bindTooltip('Датчик 6');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	bounds=FlipLL([[29.692230283138677,43.46550948355329,0],[29.350833881099692,43.32409846368336,0],[29.05767014449778,43.09914601669196,0],[28.83271769750638,42.80598228009005,0],[28.691306677636454,42.46458587805107,0],[28.64307401219938,42.09822241118974,0],[28.69130667763645,41.73185894432841,0],[28.83271769750638,41.39046254228943,0],[29.05767014449778,41.097298805687515,0],[29.350833881099692,40.87234635869611,0],[29.692230283138677,40.730935338826185,0],[30.058593750000004,40.682702673389116,0],[30.42495721686133,40.730935338826185,0],[30.766353618900315,40.87234635869611,0],[31.059517355502226,41.097298805687515,0],[31.28446980249363,41.39046254228943,0],[31.425880822363553,41.73185894432841,0],[31.474113487800626,42.09822241118974,0],[31.425880822363556,42.46458587805107,0],[31.284469802493632,42.80598228009005,0],[31.05951735550223,43.09914601669196,0],[30.766353618900315,43.32409846368336,0],[30.424957216861333,43.46550948355329,0],[29.692230283138677,43.46550948355329,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '86.47';
	//rect.bindPopup('Датчик 7');
	rect.bindTooltip('Датчик 7');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	
	bounds=FlipLL([[5.278372421106756,-4.059889619603145,0],[4.955366938885928,-4.193682871059873,0],[4.677995843159068,-4.406517198496389,0],[4.465161515722553,-4.683888294223249,0],[4.331368264265824,-5.006893776444077,0],[4.285733877771856,-5.353521355337321,0],[4.331368264265824,-5.7001489342305645,0],[4.465161515722552,-6.023154416451392,0],[4.677995843159068,-6.300525512178253,0],[4.955366938885928,-6.513359839614769,0],[5.278372421106756,-6.647153091071497,0],[5.625,-6.692787477565465,0],[5.971627578893244,-6.647153091071497,0],[6.294633061114073,-6.513359839614768,0],[6.572004156840933,-6.300525512178252,0],[6.784838484277448,-6.023154416451392,0],[6.918631735734176,-5.700148934230565,0],[6.964266122228144,-5.353521355337321,0],[6.918631735734176,-5.006893776444078,0],[6.784838484277448,-4.68388829422325,0],[6.572004156840933,-4.40651719849639,0],[6.294633061114074,-4.193682871059874,0],[5.971627578893246,-4.059889619603146,0],[5.278372421106756,-4.059889619603145,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '86.48';
	//rect.bindPopup('Датчик 8');
	rect.bindTooltip('Датчик 8');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	bounds=FlipLL([[16.33525455495052,-4.257652951094751,0],[15.99609391831439,-4.398137886612529,0],[15.70485007698891,-4.621617146144233,0],[15.481370817457206,-4.912860987469713,0],[15.340885881939428,-5.252021624105844,0],[15.292969086628776,-5.615985819155327,0],[15.340885881939428,-5.9799500142048085,0],[15.481370817457206,-6.31911065084094,0],[15.70485007698891,-6.610354492166421,0],[15.99609391831439,-6.8338337516981245,0],[16.33525455495052,-6.974318687215903,0],[16.699218750000004,-7.022235482526553,0],[17.063182945049487,-6.974318687215902,0],[17.402343581685617,-6.833833751698124,0],[17.6935874230111,-6.61035449216642,0],[17.9170666825428,-6.31911065084094,0],[18.05755161806058,-5.9799500142048085,0],[18.10546841337123,-5.615985819155327,0],[18.05755161806058,-5.252021624105845,0],[17.917066682542803,-4.912860987469715,0],[17.6935874230111,-4.621617146144234,0],[17.402343581685617,-4.398137886612531,0],[17.063182945049487,-4.257652951094752,0],[16.33525455495052,-4.257652951094751,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '86.49';
	//rect.bindPopup('Датчик 9');
	rect.bindTooltip('Датчик 9');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	 
	
	bounds=FlipLL([[28.314048302870557,-4.440912185493183,0],[27.998807131403325,-4.571489354133293,0],[27.728103400473127,-4.779207632622628,0],[27.520385121983793,-5.049911363552824,0],[27.389807953343684,-5.365152535020058,0],[27.345270512806646,-5.703447982149503,0],[27.389807953343684,-6.041743429278948,0],[27.520385121983793,-6.3569846007461805,0],[27.728103400473127,-6.627688331676378,0],[27.998807131403325,-6.8354066101657125,0],[28.31404830287056,-6.965983778805823,0],[28.652343750000004,-7.010521219342859,0],[28.99063919712945,-6.965983778805823,0],[29.305880368596682,-6.8354066101657125,0],[29.57658409952688,-6.627688331676377,0],[29.784302378016214,-6.3569846007461805,0],[29.914879546656323,-6.041743429278948,0],[29.95941698719336,-5.703447982149503,0],[29.914879546656323,-5.365152535020059,0],[29.784302378016214,-5.049911363552825,0],[29.57658409952688,-4.7792076326226285,0],[29.305880368596682,-4.571489354133294,0],[28.99063919712945,-4.4409121854931835,0],[28.314048302870557,-4.440912185493183,0]]) ;
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '86.50';
	//rect.bindPopup('Датчик 10');
	rect.bindTooltip('Датчик 10');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	*/
	
	bounds=FlipLL([[32.833987520315205,12.024379984441886,0],[32.676558482633915,11.95917074192295,0],[32.54137110321033,11.855437817257084,0],[32.43763817854447,11.720250437833501,0],[32.372428936025536,11.562821400152213,0],[32.35018727776782,11.39387923296741,0],[32.372428936025536,11.22493706578261,0],[32.43763817854447,11.06750802810132,0],[32.54137110321033,10.932320648677738,0],[32.676558482633915,10.828587724011872,0],[32.833987520315205,10.763378481492936,0],[33.00292968750001,10.74113682323523,0],[33.17187185468481,10.763378481492936,0],[33.3293008923661,10.828587724011872,0],[33.46448827178968,10.932320648677738,0],[33.568221196455546,11.06750802810132,0],[33.63343043897448,11.22493706578261,0],[33.65567209723219,11.39387923296741,0],[33.63343043897448,11.562821400152211,0],[33.568221196455546,11.720250437833501,0],[33.46448827178968,11.855437817257084,0],[33.3293008923661,11.95917074192295,0],[33.17187185468481,12.024379984441884,0],[32.833987520315205,12.024379984441886,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '86.21';
	rect.bindPopup(
	'<h3>Задвижка 3М</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW( 395 , 2, 349 , 1 , 0 , 349 , 0 , 1 );"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW( 395 , 2, 349 , 0 , 0 , 349 , 1 , 1 );"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW( 395 , 2, 349 , 0 , 0 , 349 , 1 , 0 );"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 3М');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	 
	
	bounds=FlipLL([[-25.190582415331995,25.279083564119258,0],[-25.353389269095043,25.21164675724331,0],[-25.493194683881242,25.104370289412266,0],[-25.600471151712288,24.964564874626067,0],[-25.667907958588234,24.80175802086302,0],[-25.690909397565083,24.627044746156027,0],[-25.667907958588234,24.452331471449035,0],[-25.600471151712288,24.289524617685988,0],[-25.493194683881242,24.14971920289979,0],[-25.353389269095043,24.042442735068743,0],[-25.190582415331995,23.975005928192797,0],[-25.015869140625004,23.95200448921595,0],[-24.84115586591801,23.975005928192797,0],[-24.678349012154964,24.042442735068743,0],[-24.538543597368765,24.14971920289979,0],[-24.43126712953772,24.289524617685988,0],[-24.363830322661773,24.452331471449035,0],[-24.340828883684924,24.627044746156027,0],[-24.363830322661773,24.80175802086302,0],[-24.43126712953772,24.964564874626067,0],[-24.538543597368765,25.104370289412266,0],[-24.678349012154964,25.21164675724331,0],[-24.84115586591801,25.279083564119258,0],[-25.190582415331995,25.279083564119258,0]]) ;
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '86.22';
    rect.bindPopup(
	'<h3>Насос 2M1</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
	'<tr><td>Пуск: </td><td><img src="/images/start.png"  onclick="RCW(395,1,\'C349\',5,1,0,0,0);"></td></tr>'+
	'<tr><td>Стоп: </td><td><img src="/images/stop.png"  onclick="RCW(395,1,\'C349\',5,0,0,0,0);"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Управлеие 2M1');
	rect.on('contextmenu',function(event){ }); 
    rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	bounds=FlipLL([[-15.890714902326936,25.319777852600616,0],[-16.05869577747123,25.25019789589655,0],[-16.20294422514332,25.139512169023686,0],[-16.313629952016186,24.995263721351595,0],[-16.383209908720254,24.8272828462073,0],[-16.406942336192458,24.647017162630366,0],[-16.383209908720254,24.466751479053432,0],[-16.313629952016186,24.29877060390914,0],[-16.20294422514332,24.154522156237046,0],[-16.05869577747123,24.04383642936418,0],[-15.890714902326936,23.974256472660116,0],[-15.710449218750002,23.950524045187912,0],[-15.530183535173068,23.974256472660116,0],[-15.362202660028775,24.043836429364184,0],[-15.217954212356684,24.15452215623705,0],[-15.107268485483818,24.29877060390914,0],[-15.03768852877975,24.466751479053432,0],[-15.013956101307548,24.647017162630366,0],[-15.03768852877975,24.8272828462073,0],[-15.107268485483818,24.99526372135159,0],[-15.217954212356684,25.139512169023682,0],[-15.362202660028775,25.250197895896548,0],[-15.530183535173066,25.319777852600616,0],[-15.890714902326936,25.319777852600616,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '86.23';
	rect.bindPopup(
	'<h3>Насос 2M2</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
	'<tr><td>Пуск: </td><td><img src="/images/start.png"  onclick="RCW(395,1,\'C349\',6,1,0,0,0);"></td></tr>'+
	'<tr><td>Стоп: </td><td><img src="/images/stop.png"  onclick="RCW(395,1,\'C349\',6,0,0,0,0);"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Управлеие 2M2');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	 
	
	bounds=FlipLL([[31.84473562041938,-38.34754508902063,0],[31.66638183068024,-38.42142164763122,0],[31.51322595930972,-38.53894228110125,0],[31.395705325839693,-38.692098152471765,0],[31.3218287672291,-38.87045194221091,0],[31.29663084886047,-39.061849134291535,0],[31.3218287672291,-39.25324632637216,0],[31.395705325839693,-39.431600116111305,0],[31.51322595930972,-39.58475598748182,0],[31.66638183068024,-39.70227662095185,0],[31.84473562041938,-39.77615317956244,0],[32.03613281250001,-39.80135109793107,0],[32.22753000458063,-39.77615317956244,0],[32.40588379431978,-39.70227662095185,0],[32.55903966569029,-39.58475598748182,0],[32.67656029916032,-39.431600116111305,0],[32.750436857770914,-39.25324632637216,0],[32.77563477613954,-39.061849134291535,0],[32.750436857770914,-38.87045194221091,0],[32.67656029916032,-38.692098152471765,0],[32.55903966569029,-38.53894228110125,0],[32.40588379431978,-38.42142164763122,0],[32.22753000458063,-38.34754508902063,0],[31.84473562041938,-38.34754508902063,0]]) ;
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '86.24';
		rect.bindPopup(
	'<h3>Задвижка 4М</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
    '<tr><td>Открыть: </td><td><img src="/images/start.png"  onclick="RCW( 396 , 2, 349 , 1 , 0 , 349 , 0 , 1 );"></td></tr>'+
	'<tr><td>Закрыть: </td><td><img src="/images/stop.png"   onclick="RCW( 396 , 2, 349 , 0 , 0 , 349 , 1 , 1 );"></td></tr>'+
	'<tr><td>Автомат: </td><td><img src="/images/auto.png"   onclick="RCW( 396 , 2, 349 , 0 , 0 , 349 , 1 , 0 );"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Задвижка 4M');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	
	bounds=FlipLL([[-26.541449395808574,-26.73893395513061,0],[-26.71407325941824,-26.810437100626974,0],[-26.862308731673416,-26.924182179064182,0],[-26.976053810110624,-27.07241765131936,0],[-27.04755695560699,-27.245041514929024,0],[-27.07194534696147,-27.430289738862594,0],[-27.04755695560699,-27.615537962796164,0],[-26.976053810110624,-27.78816182640583,0],[-26.862308731673416,-27.936397298661007,0],[-26.71407325941824,-28.050142377098215,0],[-26.541449395808574,-28.12164552259458,0],[-26.356201171875004,-28.14603391394906,0],[-26.170952947941434,-28.12164552259458,0],[-25.99832908433177,-28.05014237709821,0],[-25.85009361207659,-27.936397298661007,0],[-25.736348533639383,-27.78816182640583,0],[-25.664845388143018,-27.615537962796164,0],[-25.640456996788537,-27.430289738862594,0],[-25.664845388143018,-27.245041514929024,0],[-25.736348533639383,-27.07241765131936,0],[-25.850093612076588,-26.924182179064182,0],[-25.99832908433177,-26.810437100626977,0],[-26.17095294794143,-26.73893395513061,0],[-26.541449395808574,-26.73893395513061,0]]);
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '86.25';
    rect.bindPopup(
	'<h3>Насос 2M3</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
	'<tr><td>Пуск: </td><td><img src="/images/start.png"  onclick="RCW(396,1,\'C349\',5,1,0,0,0);"></td></tr>'+
	'<tr><td>Стоп: </td><td><img src="/images/stop.png"  onclick="RCW(396,1,\'C349\',5,0,0,0,0);"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Управлеие 2M3');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	 
	
	bounds=FlipLL([[-17.22718135452456,-26.711450015279794,0],[-17.40179771145977,-26.78377847853454,0],[-17.551744176522675,-26.898836447929348,0],[-17.666802145917487,-27.048782912992255,0],[-17.739130609172232,-27.223399269927466,0],[-17.76380050104454,-27.410785702577023,0],[-17.739130609172232,-27.59817213522658,0],[-17.666802145917487,-27.77278849216179,0],[-17.551744176522675,-27.922734957224694,0],[-17.40179771145977,-28.037792926619506,0],[-17.22718135452456,-28.11012138987425,0],[-17.039794921875004,-28.13479128174656,0],[-16.852408489225446,-28.11012138987425,0],[-16.677792132290236,-28.037792926619506,0],[-16.52784566722733,-27.922734957224694,0],[-16.41278769783252,-27.77278849216179,0],[-16.340459234577775,-27.59817213522658,0],[-16.315789342705468,-27.410785702577023,0],[-16.340459234577775,-27.223399269927466,0],[-16.41278769783252,-27.048782912992255,0],[-16.52784566722733,-26.89883644792935,0],[-16.677792132290236,-26.78377847853454,0],[-16.852408489225446,-26.711450015279794,0],[-17.22718135452456,-26.711450015279794,0]]) ;
	rect = L.polygon(bounds, {  color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 2 });
	rect.tag = '86.26';
 rect.bindPopup(
	'<h3>Насос 2M4</h3><hr/>'+
	'<table class ="ctrl-popup" >'+
	'<tr><td>Пуск: </td><td><img src="/images/start.png"  onclick="RCW(396,1,\'C349\',6,1,0,0,0);"></td></tr>'+
	'<tr><td>Стоп: </td><td><img src="/images/stop.png"  onclick="RCW(396,1,\'C349\',6,0,0,0,0);"></td></tr>'+
	'</table><br/>' 
	);
	rect.bindTooltip('Управлеие 2M4');
	rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
	rect.addTo(map);
	stanki.push(rect);
	
	function FlipLL(b) {
		var fb;
		var point;
		var j;
		fb=[];
		for (j = 0; j < b.length; j++) {
			 point =new  L.latLng(
			  b[j][1],               
			  b[j][0],               
               b[j][2]             
            );
			fb.push(point)
		}
		return fb;
	}


    function ReloadData() {

               function OnRequestReady(data) {

                $.each(data.data, function (i, v) {
                    var ok = false;
                    var rect;
                    var j;
                    for (j = 0; j < stanki.length; j++) {
                        if (stanki[j].tag == v.ID) {
                            ok = true;
                            rect = stanki[j];
                            break;
                        }
                    }

                    if (ok) {
						if(v.BLINK=='YES'){
							blink=true;
						}else{
							blink=false;
						}
					
						switch (v.COLOR) {
							case 'GREEN':
								 rgb = '#00FF00'; // green
								break;
							case 'YELLOW':
								rgb = '#dddd00';
								break;
							case 'RED':
								 rgb = '#FF0000'; //red
								break;
							default:
								rgb = '#000000'; //black
								break;
						}
                        rect.setStyle({ color: rgb, opacity: 1.0, fillOpacity: 0.5, weight: 1 });
                       // //rect.bindPopup(sPopup);
                       // rect.marker.bindPopup(sPopup);
                        rect.on('contextmenu',function(event){ }); 
 rect.blink = blink;
					}
					if(v.INFO !=null){
						var item=document.getElementById('v' +v.ID);
						if( item!=null){
							item.innerHTML =v.INFO;
						}else{
							console.log(v.ID);
						}
					}
               
				});
			 }
           $.ajax({
                dataType: "json",
                url: 'l286.aspx',
                success: OnRequestReady
            });
        }
        var blinkMode = false;
        function Blinker() {
            blinkMode = !blinkMode;


            var j;
            for (j = 0; j < stanki.length; j++) {

                rect = stanki[j];
                if (rect.blink == true) {
                    if (blinkMode) {
                        rect.setStyle({  fillOpacity: 0.1 });
                    } else {
                        rect.setStyle({  fillOpacity: 0.5 });
                    }
                }
               
            }
           

        }

        ReloadData();

	var intervalID = window.setInterval(ReloadData, 1000);
		var intervalID2 = window.setInterval(Blinker, 500);
   

</script>
 
</body>
</html>
